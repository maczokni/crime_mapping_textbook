<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 More on thematic maps | Crime Mapping in R</title>
  <meta name="description" content="Worksheets for labs of Crime Mapping course" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 More on thematic maps | Crime Mapping in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Worksheets for labs of Crime Mapping course" />
  <meta name="github-repo" content="maczokni/crime_mapping_textbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 More on thematic maps | Crime Mapping in R" />
  
  <meta name="twitter:description" content="Worksheets for labs of Crime Mapping course" />
  

<meta name="author" content="Reka Solymosi and Juanjo Medina" />


<meta name="date" content="2025-01-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="performing-spatial-operations-in-r.html"/>
<link rel="next" href="studying-spatial-point-patterns.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Crime Mapping in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prelude</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>0.1</b> Introduction</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i><b>0.2</b> Disclaimer</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html"><i class="fa fa-check"></i><b>1</b> A first lesson about R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#install-r-r-studio"><i class="fa fa-check"></i><b>1.1</b> Install R &amp; R Studio</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#activity-1-identifying-your-operating-system"><i class="fa fa-check"></i><b>1.1.1</b> Activity 1: Identifying your operating system</a></li>
<li class="chapter" data-level="1.1.2" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#activity-2-install-r-r-studio"><i class="fa fa-check"></i><b>1.1.2</b> Activity 2: Install R &amp; R Studio</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#open-up-and-explore-rstudio"><i class="fa fa-check"></i><b>1.2</b> Open up and explore RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#activity-3-opening-up-the-script-pane"><i class="fa fa-check"></i><b>1.2.1</b> Activity 3: Opening up the script pane</a></li>
<li class="chapter" data-level="1.2.2" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#the-four-panes-of-r-studio"><i class="fa fa-check"></i><b>1.2.2</b> The four panes of R Studio</a></li>
<li class="chapter" data-level="1.2.3" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#activity-4-interacting-with-the-4-panes"><i class="fa fa-check"></i><b>1.2.3</b> Activity 4: Interacting with the 4 panes</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#customising-the-rstudio-look"><i class="fa fa-check"></i><b>1.3</b> Customising the RStudio look</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#functions"><i class="fa fa-check"></i><b>1.3.1</b> Functions</a></li>
<li class="chapter" data-level="1.3.2" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#objects"><i class="fa fa-check"></i><b>1.3.2</b> Objects</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#packages"><i class="fa fa-check"></i><b>1.4</b> Packages</a></li>
<li class="chapter" data-level="1.5" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#exploring-data"><i class="fa fa-check"></i><b>1.5</b> Exploring data</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#activity-8-playing-around-with-data"><i class="fa fa-check"></i><b>1.5.1</b> Activity 8: Playing around with data</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#getting-organised-r-projects"><i class="fa fa-check"></i><b>1.6</b> Getting organised: R Projects</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html"><i class="fa fa-check"></i><b>2</b> Making Maps in R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#a-quick-introduction-of-terms"><i class="fa fa-check"></i><b>2.1</b> A quick introduction of terms</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#geospatial-perspective---the-basics"><i class="fa fa-check"></i><b>2.1.1</b> Geospatial Perspective - The Basics</a></li>
<li class="chapter" data-level="2.1.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#summary"><i class="fa fa-check"></i><b>2.1.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#getting-some-spatial-data-to-put-on-a-map"><i class="fa fa-check"></i><b>2.2</b> Getting some spatial data to put on a map</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#find-some-relevant-data-to-show-obtaining-data-on-crime"><i class="fa fa-check"></i><b>2.2.1</b> Find some relevant data to show: obtaining data on crime</a></li>
<li class="chapter" data-level="2.2.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#activity-1-get-some-crime-data"><i class="fa fa-check"></i><b>2.2.2</b> Activity 1: Get some crime data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#from-dataframes-to-spatial-objects-finding-spatial-information-in-our-data"><i class="fa fa-check"></i><b>2.3</b> From dataframes to spatial objects: finding spatial information in our data</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#activity-2-find-the-spatial-data"><i class="fa fa-check"></i><b>2.3.1</b> Activity 2: Find the spatial data</a></li>
<li class="chapter" data-level="2.3.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#the-point"><i class="fa fa-check"></i><b>2.3.2</b> The point</a></li>
<li class="chapter" data-level="2.3.3" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#the-line"><i class="fa fa-check"></i><b>2.3.3</b> The line</a></li>
<li class="chapter" data-level="2.3.4" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#the-polygon"><i class="fa fa-check"></i><b>2.3.4</b> The polygon</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#putting-crime-on-the-map---simple-features"><i class="fa fa-check"></i><b>2.4</b> Putting crime on the map - simple features</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#mapping-points-with-sf"><i class="fa fa-check"></i><b>2.4.1</b> Mapping points with sf</a></li>
<li class="chapter" data-level="2.4.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#mapping-data-by-joining-it-to-sf-objects"><i class="fa fa-check"></i><b>2.4.2</b> Mapping data by joining it to sf objects</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#summary-1"><i class="fa fa-check"></i><b>2.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html"><i class="fa fa-check"></i><b>3</b> Thematic maps in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#activity-1-spot-the-difference"><i class="fa fa-check"></i><b>3.1.1</b> Activity 1: Spot the difference</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#creating-thematic-maps"><i class="fa fa-check"></i><b>3.2</b> Creating thematic maps</a></li>
<li class="chapter" data-level="3.3" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#classification-systems-for-thematic-maps"><i class="fa fa-check"></i><b>3.3</b> Classification systems for thematic maps</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#activity-2-comparing-classifications"><i class="fa fa-check"></i><b>3.3.1</b> Activity 2: Comparing classifications</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#using-graduated-symbols"><i class="fa fa-check"></i><b>3.4</b> Using graduated symbols</a></li>
<li class="chapter" data-level="3.5" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#mapping-rates-rather-than-counts"><i class="fa fa-check"></i><b>3.5</b> Mapping rates rather than counts</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#activity-3-getting-population-data-from-the-census"><i class="fa fa-check"></i><b>3.5.1</b> Activity 3: Getting population data from the census</a></li>
<li class="chapter" data-level="3.5.2" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#activity-5-mapping-crime-rates"><i class="fa fa-check"></i><b>3.5.2</b> Activity 5: Mapping crime rates</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#summary-2"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html"><i class="fa fa-check"></i><b>4</b> Performing spatial operations in R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#criminality-of-place"><i class="fa fa-check"></i><b>4.1</b> Criminality of place</a></li>
<li class="chapter" data-level="4.2" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#getting-data-of-this-week"><i class="fa fa-check"></i><b>4.2</b> Getting data of this week</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-1-subsetting-using-pattern-matching"><i class="fa fa-check"></i><b>4.2.1</b> Activity 1: Subsetting using pattern matching</a></li>
<li class="chapter" data-level="4.2.2" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-2-pattern-matching-to-find-city-centre-premises"><i class="fa fa-check"></i><b>4.2.2</b> Activity 2: Pattern matching to find city centre premises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#geocoding-from-an-address"><i class="fa fa-check"></i><b>4.3</b> Geocoding from an address</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-3-getting-address-from-post-code-using-an-api"><i class="fa fa-check"></i><b>4.3.1</b> Activity 3: Getting address from post code using an API</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#making-interactive-maps-with-leaflet"><i class="fa fa-check"></i><b>4.4</b> Making interactive maps with leaflet</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-4-making-an-interactive-map"><i class="fa fa-check"></i><b>4.4.1</b> Activity 4: Making an interactive map</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#spatial-operations"><i class="fa fa-check"></i><b>4.5</b> Spatial operations</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#coordinate-reference-systems-revisited"><i class="fa fa-check"></i><b>4.5.1</b> Coordinate reference systems revisited</a></li>
<li class="chapter" data-level="4.5.2" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#meet-a-new-format-of-shapefile-geojson"><i class="fa fa-check"></i><b>4.5.2</b> Meet a new format of shapefile: geojson</a></li>
<li class="chapter" data-level="4.5.3" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-5-subset-points-to-those-within-a-polygon"><i class="fa fa-check"></i><b>4.5.3</b> Activity 5: Subset points to those within a polygon</a></li>
<li class="chapter" data-level="4.5.4" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-6-building-buffers"><i class="fa fa-check"></i><b>4.5.4</b> Activity 6: Building buffers</a></li>
<li class="chapter" data-level="4.5.5" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-7-counting-points-in-polygon"><i class="fa fa-check"></i><b>4.5.5</b> Activity 7: Counting Points in Polygon</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html"><i class="fa fa-check"></i><b>5</b> More on thematic maps</a>
<ul>
<li class="chapter" data-level="5.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#pro-tip-do-i-need-to-install-this-package"><i class="fa fa-check"></i><b>5.1</b> Pro-tip: do I need to install this package?</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-1-getting-some-messy-data"><i class="fa fa-check"></i><b>5.1.1</b> Activity 1: Getting some messy data</a></li>
<li class="chapter" data-level="5.1.2" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-3-comparing-shapefiles"><i class="fa fa-check"></i><b>5.1.2</b> Activity 3: Comparing shapefiles</a></li>
<li class="chapter" data-level="5.1.3" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-4-joining-datasets"><i class="fa fa-check"></i><b>5.1.3</b> Activity 4: Joining datasets</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#mapping-rates-learning-from-yield-mapping"><i class="fa fa-check"></i><b>5.2</b> Mapping rates, learning from yield mapping</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-5-the-case-of-saharsa"><i class="fa fa-check"></i><b>5.2.1</b> Activity 5: The case of Saharsa</a></li>
<li class="chapter" data-level="5.2.2" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-6-smoothing-as-a-way-to-address-insensitivity-to-sample-size"><i class="fa fa-check"></i><b>5.2.2</b> Activity 6: Smoothing as a way to address insensitivity to sample size</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#binning-points"><i class="fa fa-check"></i><b>5.3</b> Binning points</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#the-binning-process"><i class="fa fa-check"></i><b>5.3.1</b> The Binning Process</a></li>
<li class="chapter" data-level="5.3.2" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#different-binning-techniques"><i class="fa fa-check"></i><b>5.3.2</b> Different Binning Techniques</a></li>
<li class="chapter" data-level="5.3.3" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-7-hexbinning"><i class="fa fa-check"></i><b>5.3.3</b> Activity 7: Hexbinning</a></li>
<li class="chapter" data-level="5.3.4" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-8-rectangular-binning"><i class="fa fa-check"></i><b>5.3.4</b> Activity 8: Rectangular binning</a></li>
<li class="chapter" data-level="5.3.5" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#multivariate-binning"><i class="fa fa-check"></i><b>5.3.5</b> Multivariate binning</a></li>
<li class="chapter" data-level="5.3.6" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#benefits-of-binning"><i class="fa fa-check"></i><b>5.3.6</b> Benefits of Binning</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#a-note-of-caution-maup"><i class="fa fa-check"></i><b>5.4</b> A note of caution: MAUP</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#what-is-maup"><i class="fa fa-check"></i><b>5.4.1</b> What is MAUP?</a></li>
<li class="chapter" data-level="5.4.2" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#why-does-maup-matter"><i class="fa fa-check"></i><b>5.4.2</b> Why does MAUP matter?</a></li>
<li class="chapter" data-level="5.4.3" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#what-can-we-do"><i class="fa fa-check"></i><b>5.4.3</b> What can we do?</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#transforming-polygons"><i class="fa fa-check"></i><b>5.5</b> Transforming polygons</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-9-cartograms"><i class="fa fa-check"></i><b>5.5.1</b> Activity 9: Cartograms</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#references-and-further-reading"><i class="fa fa-check"></i><b>5.6</b> References and further reading</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#binning"><i class="fa fa-check"></i><b>5.6.1</b> Binning</a></li>
<li class="chapter" data-level="5.6.2" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#maup"><i class="fa fa-check"></i><b>5.6.2</b> MAUP</a></li>
<li class="chapter" data-level="5.6.3" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#transforming-polygons-1"><i class="fa fa-check"></i><b>5.6.3</b> Transforming polygons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html"><i class="fa fa-check"></i><b>6</b> Studying spatial point patterns</a>
<ul>
<li class="chapter" data-level="6.1" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#what-well-do-today"><i class="fa fa-check"></i><b>6.1</b> What we’ll do today</a></li>
<li class="chapter" data-level="6.2" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#getting-the-data"><i class="fa fa-check"></i><b>6.2</b> Getting the data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#activity-1-getting-the-data-into-spatstat-the-problem-with-duplicates"><i class="fa fa-check"></i><b>6.2.1</b> Activity 1: Getting the data into spatstat: the problem with duplicates</a></li>
<li class="chapter" data-level="6.2.2" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#activity-2-inspecting-our-data-with-spatstat"><i class="fa fa-check"></i><b>6.2.2</b> Activity 2: Inspecting our data with spatstat</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#density-estimates"><i class="fa fa-check"></i><b>6.3</b> Density estimates</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#activity-3-density-maps"><i class="fa fa-check"></i><b>6.3.1</b> Activity 3: Density maps</a></li>
<li class="chapter" data-level="6.3.2" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#activity-4-adding-some-context"><i class="fa fa-check"></i><b>6.3.2</b> Activity 4: Adding some context</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#spatial-point-patterns-along-networks"><i class="fa fa-check"></i><b>6.4</b> Spatial point patterns along networks</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#activity-5-spatial-point-pattern-processes-along-networks"><i class="fa fa-check"></i><b>6.4.1</b> Activity 5: Spatial point pattern processes along networks</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#recap"><i class="fa fa-check"></i><b>6.5</b> Recap</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html"><i class="fa fa-check"></i><b>7</b> Global and local spatial autocorrelation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#get-data"><i class="fa fa-check"></i><b>7.1</b> Get data</a></li>
<li class="chapter" data-level="7.2" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#what-is-a-neighbour"><i class="fa fa-check"></i><b>7.2</b> What is a neighbour?</a></li>
<li class="chapter" data-level="7.3" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#putting-neighbourness-in-our-analysis---constructing-a-spatial-weight-matrix"><i class="fa fa-check"></i><b>7.3</b> Putting ‘neighbourness’ in our analysis - constructing a spatial weight matrix</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-1-burglaries-in-manchester-city-centre-ward"><i class="fa fa-check"></i><b>7.3.1</b> Activity 1: Burglaries in Manchester City Centre ward</a></li>
<li class="chapter" data-level="7.3.2" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-2-manually-explore-neighbours"><i class="fa fa-check"></i><b>7.3.2</b> Activity 2: Manually explore neighbours</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#creating-a-list-of-neighbours"><i class="fa fa-check"></i><b>7.4</b> Creating a list of neighbours</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-3-creating-a-neighbour-list"><i class="fa fa-check"></i><b>7.4.1</b> Activity 3: Creating a neighbour list</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#generating-the-weight-matrix"><i class="fa fa-check"></i><b>7.5</b> Generating the weight matrix</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-4-building-a-spatial-weights-matrix"><i class="fa fa-check"></i><b>7.5.1</b> Activity 4: Building a spatial weights matrix</a></li>
<li class="chapter" data-level="7.5.2" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-5-row-standardised-spatial-weights-matrix"><i class="fa fa-check"></i><b>7.5.2</b> Activity 5: Row standardised spatial weights matrix</a></li>
<li class="chapter" data-level="7.5.3" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-6-spatial-weights-list"><i class="fa fa-check"></i><b>7.5.3</b> Activity 6: Spatial weights list</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#morans-i"><i class="fa fa-check"></i><b>7.6</b> Moran’s I</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-7-calculate-morans-i"><i class="fa fa-check"></i><b>7.6.1</b> Activity 7: Calculate Moran’s I</a></li>
<li class="chapter" data-level="7.6.2" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-8-moran-scatter-plot"><i class="fa fa-check"></i><b>7.6.2</b> Activity 8: Moran scatter plot</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#local-spatial-autocorrelation"><i class="fa fa-check"></i><b>7.7</b> Local spatial autocorrelation</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-9-get-data-and-weights-for-all-manchester"><i class="fa fa-check"></i><b>7.7.1</b> Activity 9: Get data and weights for all Manchester</a></li>
<li class="chapter" data-level="7.7.2" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-10-exploring-a-local-indicator-of-spatial-association-local-morans-i."><i class="fa fa-check"></i><b>7.7.2</b> Activity 10: Exploring a Local Indicator of Spatial Association: Local Moran’s I.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html"><i class="fa fa-check"></i><b>8</b> Regression analysis (a refresher)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#introduction-2"><i class="fa fa-check"></i><b>8.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-1-getting-some-homicide-data"><i class="fa fa-check"></i><b>8.1.1</b> Activity 1: Getting some homicide data</a></li>
<li class="chapter" data-level="8.1.2" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-2-familiarise-yourself-with-the-data"><i class="fa fa-check"></i><b>8.1.2</b> Activity 2: Familiarise yourself with the data</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#motivating-regression"><i class="fa fa-check"></i><b>8.2</b> Motivating regression</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-3-guessing-games"><i class="fa fa-check"></i><b>8.2.1</b> Activity 3: Guessing games</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#fitting-a-simple-regression-model"><i class="fa fa-check"></i><b>8.3</b> Fitting a simple regression model</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-4-regressing-homicide-rate-on-deprivation-score"><i class="fa fa-check"></i><b>8.3.1</b> Activity 4: Regressing homicide rate on deprivation score</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#residuals-revisited-r-squared"><i class="fa fa-check"></i><b>8.4</b> Residuals revisited: R squared</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-5-residuals-for-our-homicide-rate-model"><i class="fa fa-check"></i><b>8.4.1</b> Activity 5: Residuals for our homicide rate model</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#inference-with-regression"><i class="fa fa-check"></i><b>8.5</b> Inference with regression</a></li>
<li class="chapter" data-level="8.6" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#fitting-regression-with-categorical-predictors"><i class="fa fa-check"></i><b>8.6</b> Fitting regression with categorical predictors</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-6-homicide-rates-in-the-south-v-the-north"><i class="fa fa-check"></i><b>8.6.1</b> Activity 6: Homicide rates in the South v the North</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#motivating-multiple-regression"><i class="fa fa-check"></i><b>8.7</b> Motivating multiple regression</a></li>
<li class="chapter" data-level="8.8" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#fitting-and-interpreting-a-multiple-regression-model"><i class="fa fa-check"></i><b>8.8</b> Fitting and interpreting a multiple regression model</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-7-better-explaining-homicide-rates"><i class="fa fa-check"></i><b>8.8.1</b> Activity 7: Better explaining homicide rates</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#presenting-your-regression-results."><i class="fa fa-check"></i><b>8.9</b> Presenting your regression results.</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-8-plotting-your-results"><i class="fa fa-check"></i><b>8.9.1</b> Activity 8: Plotting your results</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#rescaling-input-variables-to-assist-interpretation"><i class="fa fa-check"></i><b>8.10</b> Rescaling input variables to assist interpretation</a></li>
<li class="chapter" data-level="8.11" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#testing-conditional-hypothesis-interactions"><i class="fa fa-check"></i><b>8.11</b> Testing conditional hypothesis: interactions</a>
<ul>
<li class="chapter" data-level="8.11.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-9-interaction-effects"><i class="fa fa-check"></i><b>8.11.1</b> Activity 9: Interaction effects</a></li>
</ul></li>
<li class="chapter" data-level="8.12" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#model-building-and-variable-selection"><i class="fa fa-check"></i><b>8.12</b> Model building and variable selection</a></li>
<li class="chapter" data-level="8.13" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#regression-assumptions"><i class="fa fa-check"></i><b>8.13</b> Regression assumptions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html"><i class="fa fa-check"></i><b>9</b> Spatial regression models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#introduction-3"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#looking-at-the-residuals-and-testing-for-spatial-autocorrelation-in-regression"><i class="fa fa-check"></i><b>9.2</b> Looking at the residuals and testing for spatial autocorrelation in regression</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-1-a-non-spatial-regression-on-spatial-data---listen-to-the-residuals"><i class="fa fa-check"></i><b>9.2.1</b> Activity 1: A non-spatial regression on spatial data - listen to the residuals</a></li>
<li class="chapter" data-level="9.2.2" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-2-spatial-autocorrelation-again"><i class="fa fa-check"></i><b>9.2.2</b> Activity 2: Spatial autocorrelation (again)</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#what-to-do-now"><i class="fa fa-check"></i><b>9.3</b> What to do now?</a></li>
<li class="chapter" data-level="9.4" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#spatial-regimes"><i class="fa fa-check"></i><b>9.4</b> Spatial Regimes</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-3-assessing-spatial-regimes-using-residuals"><i class="fa fa-check"></i><b>9.4.1</b> Activity 3: Assessing spatial regimes using residuals</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#lagrange-multipliers"><i class="fa fa-check"></i><b>9.5</b> Lagrange multipliers</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-4-lagrange-multiplier-tests"><i class="fa fa-check"></i><b>9.5.1</b> Activity 4: Lagrange multiplier tests</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#fitting-and-interpreting-a-spatially-lagged-model"><i class="fa fa-check"></i><b>9.6</b> Fitting and interpreting a spatially lagged model</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-5-spatial-lag-model"><i class="fa fa-check"></i><b>9.6.1</b> Activity 5: Spatial lag model</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#fitting-an-interpreting-a-spatial-error-model"><i class="fa fa-check"></i><b>9.7</b> Fitting an interpreting a spatial error model</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-6-spatial-error-model"><i class="fa fa-check"></i><b>9.7.1</b> Activity 6: Spatial error model</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#time-matters"><i class="fa fa-check"></i><b>9.8</b> Time matters!</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-7-small-multiples"><i class="fa fa-check"></i><b>9.8.1</b> Activity 7: Small multiples</a></li>
<li class="chapter" data-level="9.8.2" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-8-animations"><i class="fa fa-check"></i><b>9.8.2</b> Activity 8: Animations</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#recap-1"><i class="fa fa-check"></i><b>9.9</b> Recap</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Crime Mapping in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="more-on-thematic-maps" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> More on thematic maps<a href="more-on-thematic-maps.html#more-on-thematic-maps" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this session we are going to discuss some additional features around thematic maps we did not cover in week 3. We are going to discuss how to address some of the problems we confront when we are trying to use use choropleth maps, as well as some alternatives to point based maps. We will also introduce the modifiable area unit problem.</p>
<p>Before we do any of this, we need to load the libraries we will use today:</p>
<ul>
<li><code>cartogram</code></li>
<li><code>DCluster</code></li>
<li><code>dplyr</code></li>
<li><code>geogrid</code></li>
<li><code>ggplot2</code></li>
<li><code>ggspatial</code></li>
<li><code>hexbin</code></li>
<li><code>janitor</code></li>
<li><code>sf</code></li>
<li><code>sp</code></li>
<li><code>spdep</code></li>
<li><code>tmap</code></li>
<li><code>readxl</code></li>
<li><code>readr</code></li>
</ul>
<p>Some of the above are new packages we will use for the first time this week. Remember, if you don’t already have these you will need to install them.</p>
<div id="pro-tip-do-i-need-to-install-this-package" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Pro-tip: do I need to install this package?<a href="more-on-thematic-maps.html#pro-tip-do-i-need-to-install-this-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You might have noticed that in your list of available packages you might see more than you remember downloading. The idea of <em>dependencies</em> has come up throughout the semester. Packages have <em>dependencies</em> when their code is <em>dependent</em> on (uses code from) another package. For example, if we write some code that we think will be useful, so we release this in the form of the package “manchesterR”, but we use ggplot2 in the code, then ggplot2 will be a dependency of manchesterR.
As a default, R will install all the dependencies for a package when we install our package, manchesterR. So this way we might end up with some packages there that we didn’t realise we had.</p>
<p>Why are we telling you this? Well you should always check if you have a package, before installing it. And I wanted to share with you some neat code from a Stackoverflow discussion (if you are not yet familiar with Stackoverflow you have not been Google-ing your error messages enough) <a href="https://stackoverflow.com/questions/4090169/elegant-way-to-check-for-missing-packages-and-install-them">here</a> to do this. We’ll comment it a bit, so you can follow along what it does <strong>but you don’t have to if you don’t want to</strong>. This is just an extra.</p>
<p>So as a first step, you have to assign a list of all the packages you have to check to an object. Let’s say I tell you that today we will be using the following packaes: “sp”, “rgdal”, “classInt”, “RColorBrewer”, “ggplot2”, “hexbin”, “ggmap”, “XML”, and “dplyr”. Then you can add these to an object called <code>libs</code>, using the <code>c()</code> function:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="more-on-thematic-maps.html#cb1-1" tabindex="-1"></a>libs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sf&quot;</span>, <span class="st">&quot;tmap&quot;</span>, <span class="st">&quot;sp&quot;</span>, <span class="st">&quot;spdep&quot;</span>, <span class="st">&quot;DCluster&quot;</span>, <span class="st">&quot;cartogram&quot;</span>)</span></code></pre></div>
<p>Now you can run the below bit of code, and you will see in the console an output of what is and isn’t installed, as well as install the packages that are not!</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="more-on-thematic-maps.html#cb2-1" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> libs) {</span>
<span id="cb2-2"><a href="more-on-thematic-maps.html#cb2-2" tabindex="-1"></a>    <span class="co"># Check if the package is installed</span></span>
<span id="cb2-3"><a href="more-on-thematic-maps.html#cb2-3" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(x <span class="sc">%in%</span> <span class="fu">rownames</span>(<span class="fu">installed.packages</span>()))) {</span>
<span id="cb2-4"><a href="more-on-thematic-maps.html#cb2-4" tabindex="-1"></a>        <span class="co"># If not installed, print a message and install the package</span></span>
<span id="cb2-5"><a href="more-on-thematic-maps.html#cb2-5" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">&quot;Installing &quot;</span>, x, <span class="st">&quot;...</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb2-6"><a href="more-on-thematic-maps.html#cb2-6" tabindex="-1"></a>        <span class="fu">install.packages</span>(x)</span>
<span id="cb2-7"><a href="more-on-thematic-maps.html#cb2-7" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-8"><a href="more-on-thematic-maps.html#cb2-8" tabindex="-1"></a>        <span class="co"># If installed, print a message</span></span>
<span id="cb2-9"><a href="more-on-thematic-maps.html#cb2-9" tabindex="-1"></a>        <span class="fu">cat</span>(x, <span class="st">&quot;is already installed.</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb2-10"><a href="more-on-thematic-maps.html#cb2-10" tabindex="-1"></a>    }</span>
<span id="cb2-11"><a href="more-on-thematic-maps.html#cb2-11" tabindex="-1"></a>    <span class="co"># Load the package</span></span>
<span id="cb2-12"><a href="more-on-thematic-maps.html#cb2-12" tabindex="-1"></a>    <span class="fu">library</span>(x, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-13"><a href="more-on-thematic-maps.html#cb2-13" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## sf is already installed.
## tmap is already installed.
## sp is already installed.
## spdep is already installed.
## DCluster is already installed.
## cartogram is already installed.</code></pre>
<p>As you can see if you read through the comments there, this bit of code checks each package in the list you pass to tbe <code>libs</code> object when you create it, and if it is not installed it installs for you, and if it is, it just loads it for you. It can be a handy bit of code to keep around.</p>
<p>We also want to introduce <code>pacmac</code>, developed by Dason Kurkiewicz, to make your life a lot easier in the realm of R packages. While the <code>library()</code> function does its job, but could be the tedious task, installing and loading each package one by one. The <code>p_load()</code> function, a single line code will automatically checks for missing missing packages and installs/loads all libraries into you R. So, try!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="more-on-thematic-maps.html#cb4-1" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb4-2"><a href="more-on-thematic-maps.html#cb4-2" tabindex="-1"></a><span class="fu">p_load</span>(cartogram, DCluster, dplyr, geogrid, ggplot2,  ggspatial, hexbin, janitor, sf, sp, spdep, tmap, readxl, readr)</span></code></pre></div>
<div id="activity-1-getting-some-messy-data" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Activity 1: Getting some messy data<a href="more-on-thematic-maps.html#activity-1-getting-some-messy-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So far, we’ve really been spoilt by using neat and easy-to-access data typical of ‘western’ countries. This week we will have a little exercise in using data when there may not be such clear ways to access neat and tidy data. Specifically, we’re going to look at some data from India! We’ll be using two datasets:</p>
<ul>
<li>A shapefile of India (including boundaries of ‘states’ and ‘districts’)</li>
<li>District-level data on households and crop yields</li>
</ul>
<p>First of all, a number of the big universities in the US have repositories (online collections) of GIS data (like shapefiles). There are a few of them that have India shapefiles (<a href="https://gis2.harvard.edu/resources/data/india-gis-data">Harvard</a>, <a href="https://geodata.mit.edu/?f%5Bdc_format_s%5D%5B%5D=Shapefile&amp;f%5Bdct_provenance_s%5D%5B%5D=Stanford&amp;per_page=50&amp;q=india">Stanford</a>) but you need to request access to them for research purposes. If you’re doing your own research and need the shapefile of a country, it’s worth looking on these repositories for it. You can then email them to request access and usually they’ll give access no problem if you’re using it for research. But for now, I’ve already requested access and downloaded the India shapefiles, but please note that these shapefiles are for the purposes of this workshop only. Here’s the link to download the <a href="https://www.dropbox.com/scl/fo/5y9ru2a5ycr097w7uivl9/h?dl=0&amp;rlkey=o440r4caf38orvfufjf4wtp6b">shapefiles</a></p>
<p>TIP: Use this button to select all files at once, then just hit ‘Download’!
<img src="img/select_all.png" /></p>
<p><em>(if you are struggling with this, the files are in a .zip file on Blackboard as well)</em></p>
<p>You’ll notice that there are different shapefiles there, download them all for now. We will use them to demonstrate a good example of the problems you encounter when researching countries with less infrastructure. The UK has these ’LSOA’s we covered previously, which are areas that don’t change over time. In India, districts (like counties) are merged and split quite frequently and entire states (collections of districts) can merge and split too! So each shapefile we’ve downloaded will have different boundaries and different names for districts - so which one do we use?!</p>
<div id="activity-2-getting-some-crop-data-attributes" class="section level4 hasAnchor" number="5.1.1.1">
<h4><span class="header-section-number">5.1.1.1</span> Activity 2: Getting some crop data (attributes)<a href="more-on-thematic-maps.html#activity-2-getting-some-crop-data-attributes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You may be in a situation like the one described above, and you might want to consider for yourself - how can you decide what is the best shapefile to use? Well the answer will really depend on your data set! What is it that you want to represent, and what is the best matched shapefile for the job?</p>
<p>One way of deciding is to match each shapefile up with our data (like we did for crime in Manchester before) and checking which shapefile has the most matching district and state names with the dataset. So we’ll start by downloading the dataset.</p>
<p>There’s an amazing dataset called VDSA (Village Dynamics in South Asia) which covers much of India, containing both agricultural and socio-economic information. Unfortunately, the website interface isn’t great and downloading the data requires you to make a free account and download individual files for each state, which is a massive faff. So instead, I’ve already downloaded the crop production data for just one state, <strong>Bihar</strong>, and you can download it <a href="https://www.dropbox.com/s/jr9w7ejdqrft59p/Bihar.xlsx?dl=1">here</a> (this too is also on BlackBoard)</p>
<p>Great, now let’s read that data into R and have a look!</p>
<p>Just like we read ‘.csv’ files with read.csv, we can read ‘.xlsx’ (Excel) files with the <code>read_xlsx()</code> function from the <code>readxl</code> package:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="more-on-thematic-maps.html#cb5-1" tabindex="-1"></a><span class="co">#option 1: import data</span></span>
<span id="cb5-2"><a href="more-on-thematic-maps.html#cb5-2" tabindex="-1"></a>yield_data <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&#39;data/Bihar.xlsx&#39;</span>)</span>
<span id="cb5-3"><a href="more-on-thematic-maps.html#cb5-3" tabindex="-1"></a><span class="fu">glimpse</span>(yield_data)</span></code></pre></div>
<pre><code>## Rows: 688
## Columns: 59
## $ STCODE   &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
## $ STNAME   &lt;chr&gt; &quot;Bihar&quot;, &quot;Bihar&quot;, &quot;Bihar&quot;, &quot;Bihar&quot;, &quot;Bihar&quot;, &quot;Bihar&quot;, &quot;Bihar&quot;…
## $ DIST     &lt;dbl&gt; 901, 901, 901, 901, 901, 901, 901, 901, 901, 901, 901, 901, 9…
## $ DISTNAME &lt;chr&gt; &quot;Champaran&quot;, &quot;Champaran&quot;, &quot;Champaran&quot;, &quot;Champaran&quot;, &quot;Champara…
## $ YEAR     &lt;dbl&gt; 1966, 1967, 1968, 1969, 1970, 1971, 1972, 1973, 1974, 1975, 1…
## $ RICE_TA  &lt;dbl&gt; 389.49, 430.45, 450.45, 467.07, 425.50, 447.35, 435.38, 433.3…
## $ RICE_TQ  &lt;dbl&gt; 159.79, 338.03, 371.31, 286.41, 346.06, 373.39, 358.86, 322.5…
## $ WHT_TA   &lt;dbl&gt; 76.45, 98.85, 113.13, 131.65, 131.65, 140.52, 306.58, 129.65,…
## $ WHT_TQ   &lt;dbl&gt; 41.47, 84.97, 108.83, 159.96, 142.44, 229.13, 328.86, 257.18,…
## $ SORG_KA  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.02, 0.00, 0.00, 0.02, 0…
## $ SORG_KQ  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.00, 0.00, 0.01, 0…
## $ SORG_RA  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ SORG_RQ  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ SORG_TA  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.02, 0.00, 0.00, 0.02, 0…
## $ SORG_TQ  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.01, 0.00, 0.00, 0.01, 0…
## $ PMLT_TA  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.07, 0.07, 0.07, 0.07, 0.14, -…
## $ PMLT_TQ  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.03, 0.04, 0.02, 0.03, 0.08, 0…
## $ MAIZ_TA  &lt;dbl&gt; 33.56, 43.37, 42.01, 41.80, 44.71, 36.64, 39.89, 44.81, 38.19…
## $ MAIZ_TQ  &lt;dbl&gt; 22.18, 37.56, 33.87, 28.77, 52.13, 17.61, 58.23, 46.04, 27.10…
## $ FMLT_TA  &lt;dbl&gt; 1.65, 1.82, 1.60, 1.56, 1.48, 1.28, 1.60, 1.25, 1.28, 1.67, 1…
## $ FMLT_TQ  &lt;dbl&gt; 0.61, 0.99, 0.56, 0.46, 0.85, 0.60, 0.92, 0.79, 0.62, 0.62, 1…
## $ BRLY_TA  &lt;dbl&gt; 71.94, 73.87, 60.16, 54.02, 45.74, 39.25, 32.00, 34.79, 34.00…
## $ BRLY_TQ  &lt;dbl&gt; 28.53, 47.83, 32.78, 29.92, 31.88, 32.38, 19.30, 15.84, 27.18…
## $ CERL_TA  &lt;dbl&gt; 582.15, 666.16, 679.80, 708.12, 718.94, 740.40, 878.08, 702.4…
## $ CERL_TQ  &lt;dbl&gt; -1.00, -1.00, -1.00, -1.00, -1.00, 697.53, 803.27, 671.87, 63…
## $ CPEA_TA  &lt;dbl&gt; 8.29, 8.49, 6.10, 6.10, 3.71, 3.29, 4.17, 3.13, 2.65, 2.06, 1…
## $ CPEA_TQ  &lt;dbl&gt; 4.11, 4.03, 2.59, 2.56, 1.40, 1.56, 2.08, 1.78, 1.85, 1.12, 0…
## $ PPEA_TA  &lt;dbl&gt; 9.55, 11.29, 10.51, 10.51, 10.29, 8.93, 8.71, 7.56, 7.01, 6.1…
## $ PPEA_TQ  &lt;dbl&gt; 6.53, 11.43, 10.57, 10.57, 6.90, 8.83, 9.57, 5.03, 5.64, 6.12…
## $ MPUL_TA  &lt;dbl&gt; 63.32, 61.15, 56.50, 52.53, 50.19, 53.93, 149.34, -1.00, 47.5…
## $ PULS_TA  &lt;dbl&gt; 81.16, 80.93, 73.11, 69.14, 64.19, 66.16, 162.22, -1.00, 57.1…
## $ PULS_TQ  &lt;dbl&gt; -1.00, -1.00, -1.00, -1.00, -1.00, 34.15, 26.57, 21.64, 27.10…
## $ GNUT_TA  &lt;dbl&gt; 0.05, 0.08, 0.07, 0.03, 0.01, 0.02, 0.09, 0.03, 0.07, 0.03, 0…
## $ GNUT_TQ  &lt;dbl&gt; 0.03, 0.07, 0.03, 0.02, 0.03, 0.02, 0.07, 0.02, 0.07, 0.03, 0…
## $ SESA_TA  &lt;dbl&gt; 0.99, 1.03, 1.77, 1.89, 1.01, 1.07, 1.42, 1.59, 1.20, 1.11, 1…
## $ SESA_TQ  &lt;dbl&gt; 0.33, 0.39, 0.45, 0.60, 0.39, 0.54, 0.62, 0.59, 0.40, 0.24, 0…
## $ RM_TA    &lt;dbl&gt; 8.17, 8.94, 10.27, 10.98, 10.98, 10.73, 10.60, 8.00, 9.42, 8.…
## $ RM_TQ    &lt;dbl&gt; 2.57, 4.97, 4.48, 7.27, 7.28, 6.86, 6.16, 4.04, 4.87, 6.98, 7…
## $ SAFF_TA  &lt;dbl&gt; 0.01, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0…
## $ SAFF_TQ  &lt;dbl&gt; -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -…
## $ CAST_TA  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.16, 0.06, -1.00, …
## $ CAST_TQ  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.10, 0.04, -1.00, …
## $ LINS_TA  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 8.13, 9.32, -1.00, …
## $ LINS_TQ  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 5.21, 4.37, -1.00, …
## $ SUNF_TA  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.12, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0…
## $ SUNF_TQ  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.06, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0…
## $ SOYA_TA  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0…
## $ SOYA_TQ  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0…
## $ OILS_TA  &lt;dbl&gt; 19.33, 20.51, 22.06, 21.67, 20.44, 20.51, 19.75, 18.65, 19.90…
## $ OILS_TQ  &lt;dbl&gt; -1.00, -1.00, -1.00, -1.00, -1.00, -1.00, -1.00, 9.93, 9.66, …
## $ SCAN_TA  &lt;dbl&gt; 46.20, 38.05, 46.11, 52.69, 56.30, 51.10, 50.20, 48.43, 50.54…
## $ SGUR_TQ  &lt;dbl&gt; 150.80, 127.60, 193.30, 216.80, 251.50, 183.90, 200.70, 165.1…
## $ COTN_TA  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0…
## $ COTN_TQ  &lt;dbl&gt; 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.25, 0.00, 0.00, 0…
## $ FRUT_TA  &lt;dbl&gt; 17.14, 16.09, 17.35, 16.09, 18.38, 18.08, 16.63, 17.42, 17.34…
## $ VEGT_TA  &lt;dbl&gt; 16.58, 18.91, 21.81, 19.39, 21.10, 20.50, 21.76, 20.26, 21.55…
## $ TFV_TA   &lt;dbl&gt; 33.72, 35.00, 39.16, 35.48, 39.48, 38.58, 38.39, 37.68, 38.89…
## $ POTA_TA  &lt;dbl&gt; 4.28, 4.79, 7.04, 7.10, 7.30, 6.96, 7.66, 7.23, 8.01, 8.36, 8…
## $ ONIO_TA  &lt;dbl&gt; 1.22, 1.39, 1.69, 1.63, 1.78, 1.56, 1.76, 1.74, 1.64, 1.95, 1…</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="more-on-thematic-maps.html#cb7-1" tabindex="-1"></a><span class="co">#option 2: import data</span></span>
<span id="cb7-2"><a href="more-on-thematic-maps.html#cb7-2" tabindex="-1"></a><span class="co">#Alternatively, you can download Bihar.xlsx from where we saved the data</span></span>
<span id="cb7-3"><a href="more-on-thematic-maps.html#cb7-3" tabindex="-1"></a><span class="co">#Important! note that I store it in on my Data folder You HAVE TO change that if needed.</span></span>
<span id="cb7-4"><a href="more-on-thematic-maps.html#cb7-4" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://www.dropbox.com/s/dddf1tjqg0l51gp/Bihar.zip?dl=1&quot;</span> , </span>
<span id="cb7-5"><a href="more-on-thematic-maps.html#cb7-5" tabindex="-1"></a>              <span class="at">destfile=</span><span class="st">&quot;/data/Bihar.zip&quot;</span>)</span>
<span id="cb7-6"><a href="more-on-thematic-maps.html#cb7-6" tabindex="-1"></a><span class="co">#Important! note that I extract file to the data folder. you HATE TO change exdir (the directory to extract files to)</span></span>
<span id="cb7-7"><a href="more-on-thematic-maps.html#cb7-7" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;/data/Bihar.zip&quot;</span>, <span class="at">exdir =</span> <span class="st">&quot;/data/&quot;</span>)</span>
<span id="cb7-8"><a href="more-on-thematic-maps.html#cb7-8" tabindex="-1"></a>yield_data <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data/Bihar.xlsx&quot;</span>)</span></code></pre></div>
<p>After looking at the yield data, you can see it’s quite massive! Each column represents the production in weight (’_TQ’ columns) and the area farmed (’_TA’ columns) for each crop, per district, per year. That’s too much information for us! We just want rice production and area, so we’ll use the ‘select’ function to just pick the columns we want: names of states and districts, the year, and the rice information.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="more-on-thematic-maps.html#cb8-1" tabindex="-1"></a>yield_data <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(yield_data)</span>
<span id="cb8-2"><a href="more-on-thematic-maps.html#cb8-2" tabindex="-1"></a>yield_data <span class="ot">&lt;-</span> yield_data <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="more-on-thematic-maps.html#cb8-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(stname, distname, year, rice_ta, rice_tq)</span></code></pre></div>
</div>
</div>
<div id="activity-3-comparing-shapefiles" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Activity 3: Comparing shapefiles<a href="more-on-thematic-maps.html#activity-3-comparing-shapefiles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we’ve read in our rice yield data, we can test which shapefile will work best with the district names in our yield data. For this, we’ll use a basic ‘for’ loop which will test each shapefile (1951/61/71/81/91/2001) individually. This will show us which shapefile has the most matching district names (across India) with the yield data. Don’t worry about loops in R, they’re something you can learn if you’re interested but otherwise you can copy + paste the code below - so long as you understand what it’s doing overall. Chris’ advanced R will cover loops this week. N.B. You may need to change ‘shapefile_location &lt;-’ to tell R where you have saved your shapefiles!</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="more-on-thematic-maps.html#cb9-1" tabindex="-1"></a><span class="co"># Make a list of years between 1951 and 2001 at intervals every 10 years and store them as</span></span>
<span id="cb9-2"><a href="more-on-thematic-maps.html#cb9-2" tabindex="-1"></a><span class="co"># characters instead of numbers (so we can use them as names of files in the loop)</span></span>
<span id="cb9-3"><a href="more-on-thematic-maps.html#cb9-3" tabindex="-1"></a>shapefile_years <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq</span>(<span class="dv">1951</span>, <span class="dv">2001</span>, <span class="dv">10</span>), as.character)</span>
<span id="cb9-4"><a href="more-on-thematic-maps.html#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="more-on-thematic-maps.html#cb9-5" tabindex="-1"></a><span class="co"># Get a list of district names in the yield data to compare to each shapefile</span></span>
<span id="cb9-6"><a href="more-on-thematic-maps.html#cb9-6" tabindex="-1"></a>yield_dist_names <span class="ot">&lt;-</span> <span class="fu">make_clean_names</span>(<span class="fu">unique</span>(yield_data<span class="sc">$</span>distname))</span>
<span id="cb9-7"><a href="more-on-thematic-maps.html#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="more-on-thematic-maps.html#cb9-8" tabindex="-1"></a><span class="co"># Prepare an output variable</span></span>
<span id="cb9-9"><a href="more-on-thematic-maps.html#cb9-9" tabindex="-1"></a>district_match_results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">shapefile_year =</span> <span class="fu">character</span>(),</span>
<span id="cb9-10"><a href="more-on-thematic-maps.html#cb9-10" tabindex="-1"></a>                                 <span class="at">district_match_percent =</span> <span class="fu">numeric</span>())</span>
<span id="cb9-11"><a href="more-on-thematic-maps.html#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="more-on-thematic-maps.html#cb9-12" tabindex="-1"></a><span class="co"># Loop through each item in the &#39;shapefile_years&#39; list and call each item &#39;each_year&#39;</span></span>
<span id="cb9-13"><a href="more-on-thematic-maps.html#cb9-13" tabindex="-1"></a><span class="cf">for</span> (each_year <span class="cf">in</span> shapefile_years){</span>
<span id="cb9-14"><a href="more-on-thematic-maps.html#cb9-14" tabindex="-1"></a>  </span>
<span id="cb9-15"><a href="more-on-thematic-maps.html#cb9-15" tabindex="-1"></a>  <span class="co"># Change this if you need to, give the path to the directory with your shapefiles in</span></span>
<span id="cb9-16"><a href="more-on-thematic-maps.html#cb9-16" tabindex="-1"></a>  shapefile_location <span class="ot">&lt;-</span> <span class="st">&#39;data/IndiaBoundaryData/&#39;</span></span>
<span id="cb9-17"><a href="more-on-thematic-maps.html#cb9-17" tabindex="-1"></a>  </span>
<span id="cb9-18"><a href="more-on-thematic-maps.html#cb9-18" tabindex="-1"></a>  <span class="co"># Read in each shapefile</span></span>
<span id="cb9-19"><a href="more-on-thematic-maps.html#cb9-19" tabindex="-1"></a>  each_shapefile <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">paste0</span>(shapefile_location, each_year, <span class="st">&#39;.shp&#39;</span>))</span>
<span id="cb9-20"><a href="more-on-thematic-maps.html#cb9-20" tabindex="-1"></a>  </span>
<span id="cb9-21"><a href="more-on-thematic-maps.html#cb9-21" tabindex="-1"></a>  <span class="co"># Get lists of each shapefile&#39;s district names</span></span>
<span id="cb9-22"><a href="more-on-thematic-maps.html#cb9-22" tabindex="-1"></a>  shpfile_dist_names <span class="ot">&lt;-</span> <span class="fu">make_clean_names</span>(<span class="fu">unique</span>(each_shapefile<span class="sc">$</span>NAME))</span>
<span id="cb9-23"><a href="more-on-thematic-maps.html#cb9-23" tabindex="-1"></a>  </span>
<span id="cb9-24"><a href="more-on-thematic-maps.html#cb9-24" tabindex="-1"></a>  <span class="co"># Get the percentage of matching district names between yield data and each shpfile</span></span>
<span id="cb9-25"><a href="more-on-thematic-maps.html#cb9-25" tabindex="-1"></a>  dist_match <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">length</span>(dplyr<span class="sc">::</span><span class="fu">intersect</span>(yield_dist_names, shpfile_dist_names))<span class="sc">/</span><span class="fu">length</span>(yield_dist_names)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>)</span>
<span id="cb9-26"><a href="more-on-thematic-maps.html#cb9-26" tabindex="-1"></a>  </span>
<span id="cb9-27"><a href="more-on-thematic-maps.html#cb9-27" tabindex="-1"></a>  <span class="co"># Store results in output variable</span></span>
<span id="cb9-28"><a href="more-on-thematic-maps.html#cb9-28" tabindex="-1"></a>  district_match_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(district_match_results, <span class="fu">tibble</span>(<span class="at">shapefile_year =</span> each_year, </span>
<span id="cb9-29"><a href="more-on-thematic-maps.html#cb9-29" tabindex="-1"></a>                                                                     <span class="at">district_match_percent =</span> dist_match))</span>
<span id="cb9-30"><a href="more-on-thematic-maps.html#cb9-30" tabindex="-1"></a>  </span>
<span id="cb9-31"><a href="more-on-thematic-maps.html#cb9-31" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Reading layer `1951&#39; from data source 
##   `/Users/user/Desktop/resquant/crime_mapping_textbook/data/IndiaBoundaryData/1951.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 316 features and 9 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 68.11009 ymin: 6.755698 xmax: 97.4091 ymax: 37.0503
## Geodetic CRS:  WGS 84
## Reading layer `1961&#39; from data source 
##   `/Users/user/Desktop/resquant/crime_mapping_textbook/data/IndiaBoundaryData/1961.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 341 features and 50 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 68.11009 ymin: 6.755698 xmax: 97.4091 ymax: 37.0503
## Geodetic CRS:  WGS 84
## Reading layer `1971&#39; from data source 
##   `/Users/user/Desktop/resquant/crime_mapping_textbook/data/IndiaBoundaryData/1971.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 360 features and 70 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 68.11009 ymin: 6.755698 xmax: 97.4091 ymax: 37.0503
## Geodetic CRS:  WGS 84
## Reading layer `1981&#39; from data source 
##   `/Users/user/Desktop/resquant/crime_mapping_textbook/data/IndiaBoundaryData/1981.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 426 features and 59 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 68.11009 ymin: 6.755698 xmax: 97.4091 ymax: 37.0503
## Geodetic CRS:  WGS 84
## Reading layer `1991&#39; from data source 
##   `/Users/user/Desktop/resquant/crime_mapping_textbook/data/IndiaBoundaryData/1991.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 468 features and 144 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 68.11009 ymin: 6.755698 xmax: 97.4091 ymax: 37.0503
## Geodetic CRS:  WGS 84
## Reading layer `2001&#39; from data source 
##   `/Users/user/Desktop/resquant/crime_mapping_textbook/data/IndiaBoundaryData/2001.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 595 features and 170 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 68.11009 ymin: 6.755698 xmax: 97.4091 ymax: 37.0503
## Geodetic CRS:  WGS 84</code></pre>
<p>And now to check the output to see which shapefile has the highest proportion of district name matches:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="more-on-thematic-maps.html#cb11-1" tabindex="-1"></a><span class="fu">print</span>(district_match_results)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   shapefile_year district_match_percent
##   &lt;chr&gt;                           &lt;dbl&gt;
## 1 1951                               72
## 2 1961                               72
## 3 1971                               89
## 4 1981                               61
## 5 1991                               61
## 6 2001                               56</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="more-on-thematic-maps.html#cb13-1" tabindex="-1"></a><span class="co"># And plot it with ggplot</span></span>
<span id="cb13-2"><a href="more-on-thematic-maps.html#cb13-2" tabindex="-1"></a><span class="fu">ggplot</span>(district_match_results) <span class="sc">+</span></span>
<span id="cb13-3"><a href="more-on-thematic-maps.html#cb13-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> shapefile_year, <span class="at">y =</span> district_match_percent), <span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>)</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>So, before continuing you should look at the table and graph you’ve just made and decide which shapefile we should use now. Which one will be the best for representing your attribute table?</p>
</div>
<div id="activity-4-joining-datasets" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Activity 4: Joining datasets<a href="more-on-thematic-maps.html#activity-4-joining-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One last thing before we can continue mapping - joining our yield and shapefile datasets together! Some name cleaning is required first, to make sure they match up. Hopefully you found before that the 1971 shapefile has the highest percentage of district name matches with our yield data - so we’ll read that one in now:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="more-on-thematic-maps.html#cb14-1" tabindex="-1"></a><span class="co"># Read in the 1971 shapefile</span></span>
<span id="cb14-2"><a href="more-on-thematic-maps.html#cb14-2" tabindex="-1"></a>shapefile <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&#39;data/IndiaBoundaryData/1971.shp&#39;</span>)</span></code></pre></div>
<pre><code>## Reading layer `1971&#39; from data source 
##   `/Users/user/Desktop/resquant/crime_mapping_textbook/data/IndiaBoundaryData/1971.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 360 features and 70 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 68.11009 ymin: 6.755698 xmax: 97.4091 ymax: 37.0503
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="more-on-thematic-maps.html#cb16-1" tabindex="-1"></a><span class="co"># Clean the shapefile state and district names</span></span>
<span id="cb16-2"><a href="more-on-thematic-maps.html#cb16-2" tabindex="-1"></a>shapefile <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(shapefile)</span>
<span id="cb16-3"><a href="more-on-thematic-maps.html#cb16-3" tabindex="-1"></a>shapefile<span class="sc">$</span>name <span class="ot">&lt;-</span> <span class="fu">make_clean_names</span>(shapefile<span class="sc">$</span>name)</span>
<span id="cb16-4"><a href="more-on-thematic-maps.html#cb16-4" tabindex="-1"></a>shapefile<span class="sc">$</span>state_ut <span class="ot">&lt;-</span> <span class="fu">tolower</span>(shapefile<span class="sc">$</span>state_ut)</span>
<span id="cb16-5"><a href="more-on-thematic-maps.html#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="more-on-thematic-maps.html#cb16-6" tabindex="-1"></a><span class="co"># Clean the yield data&#39;s state and district names in the same way</span></span>
<span id="cb16-7"><a href="more-on-thematic-maps.html#cb16-7" tabindex="-1"></a><span class="co"># Using allow_dupes = TRUE means that repeated district names are not made into unique names</span></span>
<span id="cb16-8"><a href="more-on-thematic-maps.html#cb16-8" tabindex="-1"></a>yield_data<span class="sc">$</span>distname <span class="ot">&lt;-</span> <span class="fu">make_clean_names</span>(<span class="fu">tolower</span>(yield_data<span class="sc">$</span>distname), <span class="at">allow_dupes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-9"><a href="more-on-thematic-maps.html#cb16-9" tabindex="-1"></a>yield_data<span class="sc">$</span>stname <span class="ot">&lt;-</span> <span class="fu">tolower</span>(yield_data<span class="sc">$</span>stname)</span>
<span id="cb16-10"><a href="more-on-thematic-maps.html#cb16-10" tabindex="-1"></a></span>
<span id="cb16-11"><a href="more-on-thematic-maps.html#cb16-11" tabindex="-1"></a><span class="co"># Join the two datasets together, the &#39;by&#39; argument in right_join describes which columns</span></span>
<span id="cb16-12"><a href="more-on-thematic-maps.html#cb16-12" tabindex="-1"></a><span class="co"># are equivalent in each dataset</span></span>
<span id="cb16-13"><a href="more-on-thematic-maps.html#cb16-13" tabindex="-1"></a>district_yields <span class="ot">&lt;-</span> shapefile <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="more-on-thematic-maps.html#cb16-14" tabindex="-1"></a>  <span class="fu">right_join</span>(yield_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&#39;name&#39;</span> <span class="ot">=</span> <span class="st">&#39;distname&#39;</span>, <span class="st">&#39;state_ut&#39;</span> <span class="ot">=</span> <span class="st">&#39;stname&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-15"><a href="more-on-thematic-maps.html#cb16-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(year, name, state_ut, rice_ta, rice_tq) <span class="sc">%&gt;%</span> <span class="co"># &#39;select&#39; only selects the columns we&#39;re interested in (specify select from dplyr!)</span></span>
<span id="cb16-16"><a href="more-on-thematic-maps.html#cb16-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rice_yield =</span> rice_tq<span class="sc">/</span>rice_ta) <span class="sc">%&gt;%</span></span>
<span id="cb16-17"><a href="more-on-thematic-maps.html#cb16-17" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">district =</span> name,</span>
<span id="cb16-18"><a href="more-on-thematic-maps.html#cb16-18" tabindex="-1"></a>         <span class="at">state =</span> state_ut)</span>
<span id="cb16-19"><a href="more-on-thematic-maps.html#cb16-19" tabindex="-1"></a></span>
<span id="cb16-20"><a href="more-on-thematic-maps.html#cb16-20" tabindex="-1"></a><span class="co"># Check output</span></span>
<span id="cb16-21"><a href="more-on-thematic-maps.html#cb16-21" tabindex="-1"></a><span class="fu">head</span>(district_yields)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 6 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 84.68945 ymin: 24.95576 xmax: 86.07065 ymax: 25.73259
## Geodetic CRS:  WGS 84
##   year district state rice_ta rice_tq rice_yield                       geometry
## 1 1966    patna bihar  138.92   16.21  0.1166859 MULTIPOLYGON (((85.02075 25...
## 2 1967    patna bihar  220.10  211.13  0.9592458 MULTIPOLYGON (((85.02075 25...
## 3 1968    patna bihar  263.87  231.91  0.8788798 MULTIPOLYGON (((85.02075 25...
## 4 1969    patna bihar  262.85  178.89  0.6805783 MULTIPOLYGON (((85.02075 25...
## 5 1970    patna bihar  229.71  231.55  1.0080101 MULTIPOLYGON (((85.02075 25...
## 6 1971    patna bihar  189.13  320.56  1.6949188 MULTIPOLYGON (((85.02075 25...</code></pre>
</div>
</div>
<div id="mapping-rates-learning-from-yield-mapping" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Mapping rates, learning from yield mapping<a href="more-on-thematic-maps.html#mapping-rates-learning-from-yield-mapping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In previous sessions we discussed how to map rates. It seems a fairly straightforward issue, you calculate a rate by dividing your numerator (eg: number of crimes or rice production) by your denominator (eg: daytime population or farming area). You get your variable with the relevant rate and you map it using a choropleth map. However, things are not always that simple. Rates are funny animals. This popped up in your preparation material as the problem “insensitivity to sample size” and we will demonstrate in the next activity.</p>
<div id="activity-5-the-case-of-saharsa" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Activity 5: The case of Saharsa<a href="more-on-thematic-maps.html#activity-5-the-case-of-saharsa" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s look at our yield data, here yield means the amount of rice produced (in tonnes, 1 tonne = 1000kg) per hectare (a square of land with 100 metre-long sides) of rice farmland.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="more-on-thematic-maps.html#cb18-1" tabindex="-1"></a><span class="fu">summary</span>(district_yields<span class="sc">$</span>rice_yield)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.7690  0.9935  1.0560  1.2223  5.5423</code></pre>
<p>We can see that the district with the highest rice production rate in 1971 had a rate of 55,423 kilograms of rice for each 100,000m<span class="math inline">\(^2\)</span> area. That’s really high! Where is that place? I can tell you it’s a place call Saharsa. Check it out:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="more-on-thematic-maps.html#cb20-1" tabindex="-1"></a><span class="co"># This will show us the row with the highest yield</span></span>
<span id="cb20-2"><a href="more-on-thematic-maps.html#cb20-2" tabindex="-1"></a>district_yields <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rice_yield <span class="sc">==</span> <span class="fu">max</span>(rice_yield)) </span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 6 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 86.31699 ymin: 25.44194 xmax: 87.12818 ymax: 26.5624
## Geodetic CRS:  WGS 84
##   year district state rice_ta rice_tq rice_yield                       geometry
## 1 1971  saharsa bihar  204.86  1135.4   5.542322 MULTIPOLYGON (((87.04089 26...</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="more-on-thematic-maps.html#cb22-1" tabindex="-1"></a><span class="co"># Subset the &#39;Saharsa&#39; district data</span></span>
<span id="cb22-2"><a href="more-on-thematic-maps.html#cb22-2" tabindex="-1"></a>saharsa <span class="ot">&lt;-</span> <span class="fu">subset</span>(district_yields, district <span class="sc">==</span> <span class="st">&quot;saharsa&quot;</span>)</span></code></pre></div>
<p><a href="https://en.wikipedia.org/wiki/Saharsa_district">Saharsa district</a> in Bihar, India is known for high quality corn, much of which is exported out here to the UK! But Saharsa isn’t particularly known for its great rice production. So, what’s going on here? Why do we have a high production rate (yield) in Saharsa that makes it look like the rice capital of India?</p>
<p>Well, we can see from the output above that this happened in 1971 in Saharsa, so let’s map out the yields of all districts in Bihar in 1971 to investigate:</p>
<p>(note for the next part with neighbours to work we have to remove the one polygon with the empty geometry with <code>st_is_empty()</code></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="more-on-thematic-maps.html#cb23-1" tabindex="-1"></a><span class="co"># remove district with empty geometry</span></span>
<span id="cb23-2"><a href="more-on-thematic-maps.html#cb23-2" tabindex="-1"></a>district_yields <span class="ot">&lt;-</span> district_yields <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">st_is_empty</span>(.))</span>
<span id="cb23-3"><a href="more-on-thematic-maps.html#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="more-on-thematic-maps.html#cb23-4" tabindex="-1"></a>bihar_1971 <span class="ot">&lt;-</span> <span class="fu">filter</span>(district_yields, year <span class="sc">==</span> <span class="st">&#39;1971&#39;</span>)</span>
<span id="cb23-5"><a href="more-on-thematic-maps.html#cb23-5" tabindex="-1"></a></span>
<span id="cb23-6"><a href="more-on-thematic-maps.html#cb23-6" tabindex="-1"></a><span class="fu">tm_shape</span>(bihar_1971)<span class="sc">+</span></span>
<span id="cb23-7"><a href="more-on-thematic-maps.html#cb23-7" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&#39;rice_yield&#39;</span>)</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Saharsa is the darkly-shaded district in the top-right, it stands out massively from all other districts! Let’s plot the following year, 1972, for comparison:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="more-on-thematic-maps.html#cb24-1" tabindex="-1"></a>bihar_1972 <span class="ot">&lt;-</span> <span class="fu">filter</span>(district_yields, year <span class="sc">==</span> <span class="st">&#39;1972&#39;</span>)</span>
<span id="cb24-2"><a href="more-on-thematic-maps.html#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="more-on-thematic-maps.html#cb24-3" tabindex="-1"></a><span class="fu">tm_shape</span>(bihar_1972)<span class="sc">+</span></span>
<span id="cb24-4"><a href="more-on-thematic-maps.html#cb24-4" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&#39;rice_yield&#39;</span>)</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Now Saharsa is in the lowest yield bracket - 0.2 to 0.4, pretty far off 5.5! Why does its yield value swing so far?</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="more-on-thematic-maps.html#cb25-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">filter</span>(district_yields, district <span class="sc">==</span> <span class="st">&#39;saharsa&#39;</span>, year <span class="sc">==</span> <span class="st">&#39;1971&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(rice_ta))</span></code></pre></div>
<pre><code>## [1] 204.86</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="more-on-thematic-maps.html#cb27-1" tabindex="-1"></a>area_comparison <span class="ot">&lt;-</span> district_yields <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="more-on-thematic-maps.html#cb27-2" tabindex="-1"></a>  <span class="fu">group_by</span>(district) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="more-on-thematic-maps.html#cb27-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_area =</span> <span class="fu">mean</span>(rice_ta)) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="more-on-thematic-maps.html#cb27-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(district, mean_area)</span>
<span id="cb27-5"><a href="more-on-thematic-maps.html#cb27-5" tabindex="-1"></a></span>
<span id="cb27-6"><a href="more-on-thematic-maps.html#cb27-6" tabindex="-1"></a><span class="fu">ggplot</span>(area_comparison) <span class="sc">+</span> </span>
<span id="cb27-7"><a href="more-on-thematic-maps.html#cb27-7" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> district, <span class="at">y =</span> mean_area)) <span class="sc">+</span> </span>
<span id="cb27-8"><a href="more-on-thematic-maps.html#cb27-8" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Although it doesn’t have the smallest rice farmland area, Saharsa’s rice land is pretty small. Remember that the rate is simply dividing the number of relevant events (rice production) by the exposure variable (in this case area of rice farmland). Most times Saharsa has very low yields ( &lt; 1 tonne per hectare):</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="more-on-thematic-maps.html#cb28-1" tabindex="-1"></a>saharsa_rice_yield <span class="ot">&lt;-</span> <span class="fu">filter</span>(district_yields, district <span class="sc">==</span> <span class="st">&#39;saharsa&#39;</span>)</span>
<span id="cb28-2"><a href="more-on-thematic-maps.html#cb28-2" tabindex="-1"></a></span>
<span id="cb28-3"><a href="more-on-thematic-maps.html#cb28-3" tabindex="-1"></a><span class="fu">ggplot</span>(saharsa_rice_yield) <span class="sc">+</span></span>
<span id="cb28-4"><a href="more-on-thematic-maps.html#cb28-4" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> rice_yield)) <span class="sc">+</span></span>
<span id="cb28-5"><a href="more-on-thematic-maps.html#cb28-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Saharsa rice yield&quot;</span>)</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Saharsa’s rice production is around 130 tonnes in most years. But it only takes one good year of rice growth and, bang, it goes to the top of the league. So a standard map of rates is bound to be noisy. There is the instability that is introduced by virtue of having areas that may be sparsely populated and in which one single event, like in this case a bumper crop, will produce a very noticeable change in the rate. In fact, if you look at the counties with the highest yields in the yield dataset you will notice all of them are places like Saharsa, areas that have small areas of rice farmland (RICE_TA). So they have high yields not because they produce massive amounts of rice, but because of the instability of rates.</p>
<p>This is a problem that was first noted by epidemiologists doing disease mapping. But a number of other disciplines have now noted this and used some of the approaches developed by public health researchers that confronted this problem when producing maps of disease (techniques and approaches used by spatial epidemiologists are very similar to those used by criminologists -in case you ever think of changing careers or need inspiration for how to solve a crime analysis problem).</p>
</div>
<div id="activity-6-smoothing-as-a-way-to-address-insensitivity-to-sample-size" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Activity 6: Smoothing as a way to address insensitivity to sample size<a href="more-on-thematic-maps.html#activity-6-smoothing-as-a-way-to-address-insensitivity-to-sample-size" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One way of dealing with this is by <strong>smoothing</strong> the rates. This basically as the word implies aims for a smoother representation that avoids hard spikes associated with random noise. There are different ways of doing that. Some ways use a non-spatial approach to smoothing, using something called a <strong>empirical bayesian smoother</strong>. How does this work? This approach takes the raw rates and tries to “shrink” them towards the overall average.</p>
<p>The formal logic behind the idea of smoothing is situated in a Bayesian framework, in which the distribution of a random variable is updated after observing data. In the Empirical Bayes approach, values for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> of the prior Gamma distribution are estimated from the actual data. The smoothed rate is then expressed as a weighted average of the crude rate and the prior estimate.</p>
<p>What does this mean? Essentially, we compute a weighted average between the raw rate for each area and the global average across all areas, with weights proportional to the underlying population at risk. What this procedure does is to have the rates of smaller areas (those with a small population at risk) to have their rates adjusted considerably (brought closer to the global average), whereas the rates for the larger areas will barely change.</p>
<p>Here we are going to introduce the approach implemented in <code>DCluster</code>, a package developed for epidemiological research and detection of <a href="https://www.r-project.org/conferences/DSC-2003/Proceedings/GomezRubioEtAl.pdf">clusters of disease</a>.</p>
<p>Specifically, we use the <code>empbaysmooth(Observed, Expected)</code> function, where we specify two values, the <strong>expected</strong> value (the global average) and the <strong>observed</strong> value (the rate we actually see).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="more-on-thematic-maps.html#cb29-1" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">empbaysmooth</span>(bihar_1971<span class="sc">$</span>rice_yield, bihar_1971<span class="sc">$</span>rice_ta<span class="sc">*</span>(<span class="fu">sum</span>(bihar_1971<span class="sc">$</span>rice_yield)<span class="sc">/</span><span class="fu">sum</span>(bihar_1971<span class="sc">$</span>rice_ta)))</span></code></pre></div>
<p>In the new object we generate, which is a list, you have an element which contains the computed rates. We can add those to our dataset:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="more-on-thematic-maps.html#cb30-1" tabindex="-1"></a>bihar_1971<span class="sc">$</span>rice_yieldEBS <span class="ot">&lt;-</span> res<span class="sc">$</span>smthrr</span></code></pre></div>
<p><strong>Alternatively</strong> instead of shrinking to the global rate, we can shrink to a rate based on the neighbours of each county. In this case, instead of shrinking to a global rate, we shrink to a <em>local rate</em>. We then may be able to take unobserved heterogeneity into account. For this we need the list of neighbours, therefore we can compute the rate of the areas that surround each county:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="more-on-thematic-maps.html#cb31-1" tabindex="-1"></a>bihar_1971 <span class="ot">&lt;-</span> bihar_1971 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">neighbour =</span> <span class="fu">st_intersects</span>(.))</span>
<span id="cb31-2"><a href="more-on-thematic-maps.html#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="more-on-thematic-maps.html#cb31-3" tabindex="-1"></a><span class="co">#create the list of neighbours</span></span>
<span id="cb31-4"><a href="more-on-thematic-maps.html#cb31-4" tabindex="-1"></a>w_sf <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb31-5"><a href="more-on-thematic-maps.html#cb31-5" tabindex="-1"></a>w_sf <span class="ot">&lt;-</span> bihar_1971<span class="sc">$</span>neighbour</span>
<span id="cb31-6"><a href="more-on-thematic-maps.html#cb31-6" tabindex="-1"></a><span class="fu">class</span>(w_sf) <span class="ot">&lt;-</span> <span class="st">&quot;nb&quot;</span></span></code></pre></div>
<p>And now that we have the list of neighbours, we can use the <code>EBlocal()</code> function, and here specify the count of cases (observed), the population at risk (or rice_TA in the case of our crop yields) and then finally the neighbours list we just created above (<code>w_sf</code>). The object produced (<code>eb2</code>) consists of two columns - the raw rates (equivalent to the <code>rice_yield</code> we already calculated) and the newly estimated rates:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="more-on-thematic-maps.html#cb32-1" tabindex="-1"></a>eb2 <span class="ot">&lt;-</span> <span class="fu">EBlocal</span>(bihar_1971<span class="sc">$</span>rice_tq, bihar_1971<span class="sc">$</span>rice_ta, w_sf)</span>
<span id="cb32-2"><a href="more-on-thematic-maps.html#cb32-2" tabindex="-1"></a>bihar_1971<span class="sc">$</span>rice_yieldEBSL <span class="ot">&lt;-</span> eb2<span class="sc">$</span>est </span>
<span id="cb32-3"><a href="more-on-thematic-maps.html#cb32-3" tabindex="-1"></a>bihar_1971<span class="sc">$</span>neighbour <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>We can now plot the maps and compare them :</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="more-on-thematic-maps.html#cb33-1" tabindex="-1"></a>current_style <span class="ot">&lt;-</span> <span class="fu">tmap_style</span>(<span class="st">&quot;col_blind&quot;</span>)</span></code></pre></div>
<pre><code>## tmap style set to &quot;col_blind&quot;</code></pre>
<pre><code>## other available styles are: &quot;white&quot;, &quot;gray&quot;, &quot;natural&quot;, &quot;cobalt&quot;, &quot;albatross&quot;, &quot;beaver&quot;, &quot;bw&quot;, &quot;classic&quot;, &quot;watercolor&quot;</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="more-on-thematic-maps.html#cb36-1" tabindex="-1"></a><span class="co">#map1: rice_yield, raw value</span></span>
<span id="cb36-2"><a href="more-on-thematic-maps.html#cb36-2" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(bihar_1971) <span class="sc">+</span> </span>
<span id="cb36-3"><a href="more-on-thematic-maps.html#cb36-3" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;rice_yield&quot;</span>, <span class="at">style=</span><span class="st">&quot;quantile&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Raw rate&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Reds&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="more-on-thematic-maps.html#cb36-4" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), </span>
<span id="cb36-5"><a href="more-on-thematic-maps.html#cb36-5" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.8</span>,</span>
<span id="cb36-6"><a href="more-on-thematic-maps.html#cb36-6" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb36-7"><a href="more-on-thematic-maps.html#cb36-7" tabindex="-1"></a><span class="co">#map2: rice_yieldEBS, global</span></span>
<span id="cb36-8"><a href="more-on-thematic-maps.html#cb36-8" tabindex="-1"></a>map2<span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(bihar_1971) <span class="sc">+</span> </span>
<span id="cb36-9"><a href="more-on-thematic-maps.html#cb36-9" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;rice_yieldEBS&quot;</span>, <span class="at">style=</span><span class="st">&quot;quantile&quot;</span>, <span class="at">title =</span> <span class="st">&quot;EB Smooth&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Reds&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-10"><a href="more-on-thematic-maps.html#cb36-10" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), </span>
<span id="cb36-11"><a href="more-on-thematic-maps.html#cb36-11" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.8</span>,</span>
<span id="cb36-12"><a href="more-on-thematic-maps.html#cb36-12" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb36-13"><a href="more-on-thematic-maps.html#cb36-13" tabindex="-1"></a><span class="co">#map3: rice_yieldEBSL, local</span></span>
<span id="cb36-14"><a href="more-on-thematic-maps.html#cb36-14" tabindex="-1"></a>map3<span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(bihar_1971) <span class="sc">+</span> </span>
<span id="cb36-15"><a href="more-on-thematic-maps.html#cb36-15" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;rice_yieldEBSL&quot;</span>, <span class="at">style=</span><span class="st">&quot;quantile&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Local Smooth&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Reds&quot;</span>) <span class="sc">+</span></span>
<span id="cb36-16"><a href="more-on-thematic-maps.html#cb36-16" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>), </span>
<span id="cb36-17"><a href="more-on-thematic-maps.html#cb36-17" tabindex="-1"></a>            <span class="at">legend.title.size =</span> <span class="fl">0.8</span>,</span>
<span id="cb36-18"><a href="more-on-thematic-maps.html#cb36-18" tabindex="-1"></a>            <span class="at">legend.text.size =</span> <span class="fl">0.5</span>)</span>
<span id="cb36-19"><a href="more-on-thematic-maps.html#cb36-19" tabindex="-1"></a></span>
<span id="cb36-20"><a href="more-on-thematic-maps.html#cb36-20" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map1, map2, map3) </span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Notice that the quantiles are not the same, so that will make your comparison difficult!</p>
</div>
</div>
<div id="binning-points" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Binning points<a href="more-on-thematic-maps.html#binning-points" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’re going to move away from area-level data now, and go back to point-level data.</p>
<p>In GIS it is often difficult to present point-based data because in many instances there are several different points and data symbologies that need to be shown. As the number of different data points grows they can become complicated to interpret and manage which can result in convoluted and sometimes inaccurate maps. This becomes an even larger problem in web maps that are able to be depicted at different scales because smaller scale maps need to show more area and more data. This makes the maps convoluted if multiple data points are included.</p>
<p>In many maps there are so many data points included that little can be interpreted from them. In order to reduce congestion on maps many GIS users and cartographers have turned to a process known as binning.</p>
<blockquote>
<p><strong>Binning</strong> is defined as the process of grouping pairs of locations based on their distance from one another. These points can then be grouped as categories to make less complex and more meaningful maps.</p>
</blockquote>
<p>Researchers and practitioners often require a way to systematically divide a region into equal-sized portions. As well as making maps with many points easier to read, binning data into regions can help identify spatial influence of neighbourhoods, and can be an essential step in developing systematic sampling designs.</p>
<p>This approach to binning generates an array of repeating shapes over a user-specified area. These shapes can be hexagons, squares, rectangles, triangles, circles or points, and they can be generated with any directional orientation.</p>
<p><img src="img/shape_patterns_manual.jpg" /></p>
<div id="the-binning-process" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> The Binning Process<a href="more-on-thematic-maps.html#the-binning-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Binning is a data modification technique that changes the way data is shown at small scales. It is done in the pre-processing stage of data analysis to convert the original data values into a range of small intervals, known as a bin. These bins are then replaced by a value that is representative of the interval to reduce the number of data points.</p>
<p>Spatial binning (also called <em>spatial discretization</em>) discretizes the location values into a small number of groups associated with geographical areas or shapes. The assignment of a location to a group can be done by any of the following methods:
- Using the coordinates of the point to identify which “bin” it belongs to.
- Using a common variable in the attribute table of the bin and the point layers.</p>
</div>
<div id="different-binning-techniques" class="section level3 hasAnchor" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Different Binning Techniques<a href="more-on-thematic-maps.html#different-binning-techniques" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Binning itself is a general term used to describe the grouping of a dataset’s values into smaller groups <a href="http://indiemaps.com/blog/2011/10/hexbins/">(Johnson, 2011)</a>. The bins can be based on a variety of factors and attributes such as spatial and temporal and can thus be used for many different projects.</p>
<div id="choropleth-maps" class="section level4 hasAnchor" number="5.3.2.1">
<h4><span class="header-section-number">5.3.2.1</span> Choropleth maps<a href="more-on-thematic-maps.html#choropleth-maps" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You might be thinking, “grouping points into a larger spatial unit, haven’t we already done this when making choropleth maps?”. In a way you are right. Choropleth maps are another type of map to that uses binning. Proportional symbol and choropleth maps group similar data points together to show a range of data instead of many individual points. We’ve covered this extensively, and is generally the best approch to consider spatial grouping of your point variables, because the polygons (shapes) to which you are aggregating your points are <em>meaningful</em>. You can group into LSOAs because you want to show variation in neighbourhoods. Or you can group into police force areas because you want to look at differences between those units of analysis. But sometimes there is just not a geography present to meet your needs.</p>
<p>Let’s say you are conducting some days of action in Manchester city centre, focusing on antisocial behaviour. You are going to put up some information booths and staff them with officers to engage with the local population about antisocial behaviour. For these to be most effective, as an analyst you decide that they should go into the areas with the highest <em>count</em> of antisocial beaviour. You want to be very specific about where you put these as well, and so LSOA level would be too broad, you want to zoom in more. One approach can be to split central Manchester into some smaller polygons, and just calculate the number of antisocial behaviour incidents recorded in each. That way you can then decide to put your information booths somewhere inside the top 5 highest count bins.</p>
</div>
<div id="rectangular-binning" class="section level4 hasAnchor" number="5.3.2.2">
<h4><span class="header-section-number">5.3.2.2</span> Rectangular binning<a href="more-on-thematic-maps.html#rectangular-binning" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The aggregation of incident point data to regularly shaped grids is used for many reasons such as normalizing geography for mapping or to mitigate the issues of using irregularly shaped polygons created arbitrarily (such as county boundaries or block groups that have been created from a political process). Regularly shaped grids can only be comprised of equilateral triangles, squares, or hexagons, as these three polygon shapes are the only three that can tessellate (repeating the same shape over and over again, edge to edge, to cover an area without gaps or overlaps) to create an evenly spaced grid.</p>
<p>Rectangular binning is the simplest binning method and as such it heavily used. However, there are some reasons why rectangular bins are less preferable over hexagonal bins. Before we cover this, let’s have a look at hexagonal bins.</p>
</div>
<div id="hexagonal-binning" class="section level4 hasAnchor" number="5.3.2.3">
<h4><span class="header-section-number">5.3.2.3</span> Hexagonal binning<a href="more-on-thematic-maps.html#hexagonal-binning" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In many applications binning is done using a technique called <strong>hexagonal binning</strong>. This technique uses hexagon shapes to create a grid of points and develops a spatial histogram that shows different data points as a range or group of pairs with common distances and directions. In hexagonal binning the number of points falling within a particular rectangular or hexagon in a gridded surface is what makes the different colors to easily visualize data <a href="https://www.mapbox.com/blog/binning-alternative-point-maps/">(Smith, 2012)</a>. Hexagonnal binning was first developed in 1987 and today “hexbinning” is conducted by laying a hexagonal grid on top of 2-dimensional data <a href="http://indiemaps.com/blog/2011/10/hexbins/">(Johnson, 2011)</a>. Once this is done users can conduct data point counts to determine the number of points for each hexagon <a href="http://indiemaps.com/blog/2011/10/hexbins/">(Johnson, 2011)</a>. The bins are then symbolized differently to show meaningful patterns in the data.</p>
</div>
</div>
<div id="activity-7-hexbinning" class="section level3 hasAnchor" number="5.3.3">
<h3><span class="header-section-number">5.3.3</span> Activity 7: Hexbinning<a href="more-on-thematic-maps.html#activity-7-hexbinning" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So how can we use hexbinning to solve our antisocial behaviour days of action task? Well let’s say we split Manchester city centre into hexagons, and count the number of antisocial behaviour instances in these. We can then identify the top hexagons, and locate our booths somewhere within these.</p>
<p>Also let’s get some data. You could go and get this data yourself from police.uk, we’ve been through all the steps for downloading data from there a few times now. But for now, I have a tidied set of data ready for you. This data is one year’s worth of antisocial behaviour from the <a href="data.police.uk">police.uk</a> data, from May 2016 to May 2017, for the borough of Manchester.</p>
<p>We can take our GMP crimes data, and select only the cases from ASB using the crime.type variable. If you want, however, I have already done this, so you can also download from my dropbox using the link here, (or get it from Blackboard):</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="more-on-thematic-maps.html#cb37-1" tabindex="-1"></a>mcr_asb <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://www.dropbox.com/s/93a0ovgcxz6pgiz/manchester_asb.csv?dl=1&quot;</span>)</span></code></pre></div>
<pre><code>## New names:
## Rows: 32162 Columns: 15
## ── Column specification
## ──────────────────────────────────────────────────────── Delimiter: &quot;,&quot; chr
## (8): Month, Reported.by, Falls.within, Location, LSOA.code, LSOA.name, C... dbl
## (4): ...1, X, Longitude, Latitude lgl (3): Crime.ID, Last.outcome.category,
## Context
## ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
## Specify the column types or set `show_col_types = FALSE` to quiet this message.
## • `` -&gt; `...1`</code></pre>
<p>This is currently just a text dataframe, so we need to let R know that actually this is a spatial object, who’s geometry can be find in its longitude and latitude coordinates. As we have long/lat we can assure it’s in WGS 84 projection.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="more-on-thematic-maps.html#cb39-1" tabindex="-1"></a>sf_mcr_asb <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mcr_asb, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Latitude&quot;</span>), </span>
<span id="cb39-2"><a href="more-on-thematic-maps.html#cb39-2" tabindex="-1"></a>                 <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">agr =</span> <span class="st">&quot;constant&quot;</span>)</span></code></pre></div>
<p>Now one thing that this does is it consumes our lng and lat columns into a geometry attribute. This is generally OK, but for the binning we will do, we would like to have them as separate coordinates. We can do this by adding the argument <code>remove = FALSE</code> to our <code>st_as_sf</code> function. We will also rename these coordinate columns to be <code>lng</code> and <code>lat</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="more-on-thematic-maps.html#cb40-1" tabindex="-1"></a><span class="co">#extract the coords to some columns, &quot;lng&quot; and &quot;lat&quot;</span></span>
<span id="cb40-2"><a href="more-on-thematic-maps.html#cb40-2" tabindex="-1"></a>sf_mcr_asb<span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mcr_asb, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;Longitude&quot;</span>, <span class="st">&quot;Latitude&quot;</span>), </span>
<span id="cb40-3"><a href="more-on-thematic-maps.html#cb40-3" tabindex="-1"></a>                       <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">agr =</span> <span class="st">&quot;constant&quot;</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="more-on-thematic-maps.html#cb40-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">lng =</span> Longitude,</span>
<span id="cb40-5"><a href="more-on-thematic-maps.html#cb40-5" tabindex="-1"></a>         <span class="at">lat =</span> Latitude)</span></code></pre></div>
<p>As a first step, we can plot asb in the borough of Manchester using simple ggplot! Remember the data visualisation session from weeks ago? We discussed how ggplot is such a great tool for building visualisations, because you can apply whatever geometry best suits your data. So for us to just have a look at the hexbinned version of our point data of antisocial behaviour, we can use the <code>stat_binhex()</code> function. We can also recreate the thematic map element, as we can use the frequency of points in each hex to shade each hexbin from white (least number of incidents) to red (most nuber of incidents).</p>
<p>So let’s have a go:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="more-on-thematic-maps.html#cb41-1" tabindex="-1"></a><span class="fu">ggplot</span>(sf_mcr_asb, <span class="fu">aes</span>(lng, lat)) <span class="sc">+</span>                        <span class="co">#define data and variables for x and y axes</span></span>
<span id="cb41-2"><a href="more-on-thematic-maps.html#cb41-2" tabindex="-1"></a>  <span class="fu">stat_binhex</span>() <span class="sc">+</span>                                                         <span class="co">#add binhex layer (hexbin)</span></span>
<span id="cb41-3"><a href="more-on-thematic-maps.html#cb41-3" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="at">name =</span> <span class="st">&quot;Frequency&quot;</span>)    <span class="co">#add shading based on number of ASB incidents</span></span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Neat, but doesn’t quite tell us <em>where</em> that really dark hexbon actually is. So it would be much better if we could do this with a basemap as the background, rather than our grey ggplot theme.</p>
<p>Now, we can apply the same code as we used above, for the ggplot, to this ggmap, to add our hexbins on top of this basemap:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="more-on-thematic-maps.html#cb42-1" tabindex="-1"></a><span class="fu">ggplot</span>(sf_mcr_asb, <span class="fu">aes</span>(<span class="at">x =</span> lng, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb42-2"><a href="more-on-thematic-maps.html#cb42-2" tabindex="-1"></a>  <span class="fu">annotation_map_tile</span>() <span class="sc">+</span> </span>
<span id="cb42-3"><a href="more-on-thematic-maps.html#cb42-3" tabindex="-1"></a>  <span class="fu">stat_binhex</span>(<span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span>                                                <span class="co">#add binhex layer (hexbin)</span></span>
<span id="cb42-4"><a href="more-on-thematic-maps.html#cb42-4" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="at">name =</span> <span class="st">&quot;Frequency&quot;</span>)    <span class="co">#add shading based on number of ASB incidents</span></span></code></pre></div>
<pre><code>## Zoom: 10</code></pre>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Now this should give you some more context! Woo!</p>
<p>So I mentioned we’d go over some reasons why you should consider aggregating into a hexagon grid rather than other shape:</p>
<ul>
<li>Hexagons reduce sampling bias due to <a href="https://link.springer.com/chapter/10.1007/978-0-387-09688-9_5">edge effects</a> of the grid shape. The edge effects of bounded space refers to the problem of truncated data that can skew the results of subsequent analyses (we’ll get to this in the next section). This is related to the low perimeter-to-area ratio of the shape of the hexagon. A circle has the lowest ratio but cannot tessellate to form a continuous grid. Hexagons are the most circular-shaped polygon that can tessellate to form an evenly spaced grid.</li>
<li>This circularity of a hexagon grid allows it to represent curves in the patterns of your data more naturally than square grids.</li>
<li>When comparing polygons with equal areas, the more similar to a circle the polygon is, the closer to the centroid the points near the border are (especially points near the vertices). This means that any point inside a hexagon is closer to the centroid of the hexagon than any given point in an equal-area square or triangle would be (this is due to the more acute angles of the square and triangle versus the hexagon).</li>
<li>Hexagons are preferable when your analysis includes aspects of connectivity or movement paths. Due to the linear nature of rectangles, fishnet grids can draw our eyes to the straight, unbroken, parallel lines which may inhibit the underlying patterns in the data. Hexagons tend to break up the lines and allow any curvature of the patterns in the data to be seen more clearly and easily. This breakup of artificial linear patterns also diminishes any orientation bias that can be perceived in fishnet grids.</li>
<li>If you are working over a large area, a hexagon grid will suffer less distortion due to the curvature of the earth than the shape of a fishnet grid.</li>
<li>Finding neighbors is more straightforward with a hexagon grid. Since the edge or length of contact is the same on each side, the centroid of each neighbor is equidistant. However, with a fishnet grid, the Queen’s Case (above/below/right/left) neighbor’s centroids are N units away, while the centroids of the diagonal (Rook) neighbors are farther away (exactly the square root of 2 times N units away).</li>
<li>Since the distance between centroids is the same in all six directions with hexagons, if you are using a distance band to find neighbors or are using the Optimized Hot Spot Analysis, Optimized Outlier Analysis or Create Space Time Cube By Aggregating Points tools, you will have more neighbors included in the calculations for each feature if you are using hexagonal grid as opposed to a fishnet grid.</li>
</ul>
<p><img src="img/EE17F7E03F82-web.png" /></p>
</div>
<div id="activity-8-rectangular-binning" class="section level3 hasAnchor" number="5.3.4">
<h3><span class="header-section-number">5.3.4</span> Activity 8: Rectangular binning<a href="more-on-thematic-maps.html#activity-8-rectangular-binning" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now, to again illustrate the differences of different approaches, let’s see what this map would look like with:</p>
<ol style="list-style-type: lower-alpha">
<li>rectangular binning:</li>
</ol>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="more-on-thematic-maps.html#cb44-1" tabindex="-1"></a><span class="fu">ggplot</span>(sf_mcr_asb, <span class="fu">aes</span>(<span class="at">x =</span> lng, <span class="at">y =</span> lat)) <span class="sc">+</span> </span>
<span id="cb44-2"><a href="more-on-thematic-maps.html#cb44-2" tabindex="-1"></a>  <span class="fu">annotation_map_tile</span>() <span class="sc">+</span> </span>
<span id="cb44-3"><a href="more-on-thematic-maps.html#cb44-3" tabindex="-1"></a>  <span class="fu">stat_bin2d</span>(<span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb44-4"><a href="more-on-thematic-maps.html#cb44-4" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>,<span class="st">&quot;red&quot;</span>), </span>
<span id="cb44-5"><a href="more-on-thematic-maps.html#cb44-5" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Frequency&quot;</span>) </span></code></pre></div>
<pre><code>## Zoom: 10</code></pre>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>hexagonal binning:</li>
</ol>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="more-on-thematic-maps.html#cb46-1" tabindex="-1"></a><span class="fu">ggplot</span>(sf_mcr_asb, <span class="fu">aes</span>(<span class="at">x =</span> lng, <span class="at">y =</span> lat)) <span class="sc">+</span> </span>
<span id="cb46-2"><a href="more-on-thematic-maps.html#cb46-2" tabindex="-1"></a>  <span class="fu">annotation_map_tile</span>() <span class="sc">+</span> </span>
<span id="cb46-3"><a href="more-on-thematic-maps.html#cb46-3" tabindex="-1"></a>  <span class="fu">stat_binhex</span>(<span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb46-4"><a href="more-on-thematic-maps.html#cb46-4" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>,<span class="st">&quot;red&quot;</span>), </span>
<span id="cb46-5"><a href="more-on-thematic-maps.html#cb46-5" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Frequency&quot;</span>)</span></code></pre></div>
<pre><code>## Zoom: 10</code></pre>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>a simple “heatmap” (we will discuss these more thoroughly next week):</li>
</ol>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="more-on-thematic-maps.html#cb48-1" tabindex="-1"></a><span class="fu">ggplot</span>(sf_mcr_asb, <span class="fu">aes</span>(<span class="at">x =</span> lng, <span class="at">y =</span> lat)) <span class="sc">+</span> </span>
<span id="cb48-2"><a href="more-on-thematic-maps.html#cb48-2" tabindex="-1"></a>  <span class="fu">annotation_map_tile</span>() <span class="sc">+</span> </span>
<span id="cb48-3"><a href="more-on-thematic-maps.html#cb48-3" tabindex="-1"></a>  <span class="fu">stat_density2d</span>(<span class="fu">aes</span>(<span class="at">fill =</span> ..level.., <span class="co"># value corresponding to discretized density estimates </span></span>
<span id="cb48-4"><a href="more-on-thematic-maps.html#cb48-4" tabindex="-1"></a>                     <span class="at">alpha =</span> ..level..), </span>
<span id="cb48-5"><a href="more-on-thematic-maps.html#cb48-5" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">&quot;polygon&quot;</span>) <span class="sc">+</span>  <span class="co"># creates the bands of differenc colors</span></span>
<span id="cb48-6"><a href="more-on-thematic-maps.html#cb48-6" tabindex="-1"></a>  <span class="do">## Configure the colors, transparency and panel</span></span>
<span id="cb48-7"><a href="more-on-thematic-maps.html#cb48-7" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>,<span class="st">&quot;red&quot;</span>), </span>
<span id="cb48-8"><a href="more-on-thematic-maps.html#cb48-8" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">&quot;Frequency&quot;</span>) </span></code></pre></div>
<pre><code>## Warning: The dot-dot notation (`..level..`) was deprecated in ggplot2 3.4.0.
## ℹ Please use `after_stat(level)` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre><code>## Zoom: 11</code></pre>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Look at the difference between the three maps (hex, rectangle, and density). How would your conclusions change if you were given these maps? Would you make different decisions about where to place your booths for the days of action? Why or why not? Discuss.</p>
</div>
<div id="multivariate-binning" class="section level3 hasAnchor" number="5.3.5">
<h3><span class="header-section-number">5.3.5</span> Multivariate binning<a href="more-on-thematic-maps.html#multivariate-binning" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Multivariate binning is another binning method that lets you visualise slightly more complex data. In this method there can be many different variables consisting of different types of data. Like other binning methods the data is typically grouped with the sum or average of the data. Different types of symbology (such as size, shape and color) can also be used to represent this data as well.</p>
<p>We won’t be covering this here but just so you can have a look at some examples <a href="http://www.geo.hunter.cuny.edu/~ssun/R-Spatial/spatialops.html">here</a>.</p>
</div>
<div id="benefits-of-binning" class="section level3 hasAnchor" number="5.3.6">
<h3><span class="header-section-number">5.3.6</span> Benefits of Binning<a href="more-on-thematic-maps.html#benefits-of-binning" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Because of the plethora of data types available and the wide variety of projects being done in GIS, binning is a popular method for mapping complex data and making it meaningful. Binning is a good option for map makers as well as users because it makes data easy to understand and it can be both static and interactive on many different map scales. If every different point were shown on a map it would have to be a very large scale map to ensure that the data points did not overlap and were easily understood by people using the maps.</p>
<p>According to Kenneth Field, an Esri Research Cartographer, <em>“Data binning is a great alternative for mapping large point-based data sets which allows us to tell a better story without interpolation. Binning is a way of converting point-based data into a regular grid of polygons so that each polygon represents the aggregation of points that fall within it.”</em></p>
<p>By using binning to create categories of data maps are easier to understand, more accurate and more visually appealing.</p>
<p>Hexbin plots can be viewed as an alternative to scatter plots. The hexagon-shaped bins were introduced to plot densely packed sunflower plots. They can be used to plot scatter plots with high-density data.</p>
</div>
</div>
<div id="a-note-of-caution-maup" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> A note of caution: MAUP<a href="more-on-thematic-maps.html#a-note-of-caution-maup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that we’ve shown you how to do a lot of spatial crime analysis, we wanted to close with some words of caution. Remember that everything you’ve learned here are just tools that you will be applying to data you are working with, but it’s up to you, the researcher, the analyst, the domain expert, to apply and use these with careful consideration and cautions. This discussion is very much part of spatial crime analysis, and an important field of thought.</p>
<p>I borrow here from George Renghert and Brian Lockwood:</p>
<blockquote>
<p>When spatial analysis of crime is conducted, the analyst should not ignore the spatial units that data are aggregated into and the impact of this choice on the interpretation of findings. Just as several independent variables are considered to determine whether they have statistical significance, a consideration of multiple spatial units of analysis should be made as well, in order to determine whether the choice of aggregation level used in a spatial analysis can result in biased findings.</p>
</blockquote>
<p>In particular, they highlight four main issues inherent in most studies of space:</p>
<ul>
<li>issues associated with politically bounded units of aggregation,</li>
<li>edge effects of bounded space</li>
<li>the modifiable aerial unit problem (MAUP)</li>
<li>and ways in which the results of statistical analyses can be manipulated by changes in the level of
aggregation.</li>
</ul>
<p>In this lab we will focus on <strong>MAUP</strong>, but if you are interested in this kind of work, you should definitely read their paper to consider the other issues as well. There are techniques that can be used to alleviate each of the methodological difficulties, and they are described in accessible detail in their paper: <a href="https://link.springer.com/chapter/10.1007/978-0-387-09688-9_5">Rengert, George F., and Brian Lockwood. “Geographical units of analysis and the analysis of crime.” Putting crime in its place. Springer, New York, NY, 2009. 109-122.</a></p>
<div id="what-is-maup" class="section level3 hasAnchor" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> What is MAUP?<a href="more-on-thematic-maps.html#what-is-maup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Modifiable Areal Unit Problem (MAUP) is an important issue for those who conduct spatial analysis using units of analysis at aggregations higher than incident level. It is one of the better-known problems in geography and spatial analysis. This phenomenon illustrates both the need for considering space in one’s analysis, and the fundamental uncertainties that accompany real-world analysis.</p>
<p>The MAUP is “a problem arising from the imposition of artificial units of spatial reporting on continuous geographical phenomena, leading to artifacts or errors are created when one groups data into units for analysis.</p>
<p>The classic text on MAUP is the 1983 paper <a href="https://www.uio.no/studier/emner/sv/iss/SGO9010/openshaw1983.pdf">Openshaw, Stan. “The modifiable areal unit problem. CATMOG (Concepts and techniques in modern geography) 38.” Geo Abstracts, Norwich. 1984.</a>.</p>
<p>There are two distinct types of MAUP: Scale (i.e. determining the appropriate size of units for aggregation) and zone (i.e. drawing boundaries or grouping).</p>
<div id="scale" class="section level4 hasAnchor" number="5.4.1.1">
<h4><span class="header-section-number">5.4.1.1</span> Scale<a href="more-on-thematic-maps.html#scale" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The scale problem involves results that change based on data that are analyzed at higher or lower levels of aggregation (Changing the number of units). For example, evaluating data at the state level vs. Census tract level.</p>
<p>The scale problem has moved to the forefront of geographical criminology as a result of the recent interest in small-scale geographical units of analysis. It has been suggested that smaller is better since small areas can be directly perceived by individuals and are likely to be more homogenous than larger areas.
- <a href="https://link.springer.com/article/10.1007/s10940-016-9297-6">Gerell, Manne. “Smallest is better? The spatial distribution of arson and the modifiable areal unit problem.” Journal of quantitative criminology 33.2 (2017): 293-318.</a></p>
</div>
<div id="zone" class="section level4 hasAnchor" number="5.4.1.2">
<h4><span class="header-section-number">5.4.1.2</span> Zone<a href="more-on-thematic-maps.html#zone" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The zonal problem involves keeping the same scale of research (say, at the state level) but changing the actual shape and size of those areas.</p>
<p>The basic issue with the MAUP is that aggregate units of analysis are often arbitrarily produced by whom ever is in charge of creating the aggregate units. A classic example of this problem is known as Gerrymandering. Gerrymandering involves shaping and re-shaping voting districts based on the political affiliations of the resident citizenry.</p>
<p>The inherent problem with the MAUP and with situations such as Gerrymandering is that units of analysis are not based on geographic principles, and instead are based on political and social biases. For researchers and practitioners the MAUP has very important implications for research findings because it is possible that as arbitrarily defined units of analysis change shape findings based on these units will change as well.</p>
<p>When spatial data are derived from counting or averaging data within areal units, the form of those areal units affects the data recorded, and any statistical measures derived from the data. Modifying the areal units therefore changes the data. Two effects are involved: a zoning effect arising from the particular choice of areas at a given scale; and an aggregation effect arising from the extent to which data are aggregated over smaller or larger areas. The modifiable areal unit problem arises in part from edge effect.</p>
<p>If you’re interested, in particular about politics and voting, you can read this interesting piece to learn <a href="https://projects.fivethirtyeight.com/redistricting-maps/">more about gerrymandering</a></p>
</div>
</div>
<div id="why-does-maup-matter" class="section level3 hasAnchor" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Why does MAUP matter?<a href="more-on-thematic-maps.html#why-does-maup-matter" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The practical implications of MAUP are immense for almost all decision-making processes involving GIS technology, since with the availability of aggregated maps, policy could easily focus on issues and problems which might look different if the aggregation scheme used were changed .</p>
<p>All studies based on geographical areas are susceptible to MAUP. The implications of the MAUP affect potentially any area level data, whether direct measures or complex model-based estimates. Here are a few examples of situations where the MAUP is expected to make a difference:</p>
<ul>
<li>The special case of the ecological fallacy is always present when Census area data are used to formulate and evaluate policies that address problems at individual level, such as deprivation. Also, it is recognised that a potential source of error in the analysis of Census data is ‘the arrangement of continuous space into defined regions for purposes of data reporting’</li>
<li>The MAUP has an impact on indices derived from areal data, such as measures of segregation, which can change significantly as a result of using different geographical levels of analysis to derive composite measures .</li>
<li>The choice of boundaries for reporting mortality ratios is not without consequences: when the areas are too small, the values estimated are unstable, while when the areas are too large, the values reported may be over-smoothed, i.e. meaningful variation may be lost .</li>
<li><a href="https://link.springer.com/article/10.1007/s10940-016-9297-6">Gerell, Manne. “Smallest is better? The spatial distribution of arson and the modifiable areal unit problem.” Journal of quantitative criminology 33.2 (2017): 293-318.</a></li>
</ul>
</div>
<div id="what-can-we-do" class="section level3 hasAnchor" number="5.4.3">
<h3><span class="header-section-number">5.4.3</span> What can we do?<a href="more-on-thematic-maps.html#what-can-we-do" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Most often you will just have to remain aware of the MAUP and it’s possible effects. There are some techniques, that can help you address these issues, and the chapter pointed out at the beginning of this section is a great place to start to explore these. It is possible to use also an alternative, zone-free approach to mapping these crime patterns, perhaps by using kernel density estimation. Here we model the relative density of the points as a density surface - essentially a function of location (x,y) representing the relative likelihood of occurrence of an event at that point. We have covered KDE elsewhere in this course.</p>
<p>For the purposes of this course, it’s enough that you know of, and understand the MAUP and its implications. Always be smart when choosing your appropriate spatial unit of analysis, and when you use binning of any form, make sure you consider how and if your conclusions might change compared to another possible approach.</p>
</div>
</div>
<div id="transforming-polygons" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Transforming polygons<a href="more-on-thematic-maps.html#transforming-polygons" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When you have meaningful spatial units of analysis in your polygons, for example you are interested specifically in Local Authorities, it might make sense to stick with what we did last week, and aggregate the points into these polygons to create thematic maps. However, while thematic maps are an accessible and visually appealing method for displaying spatial information, they can also be highly misleading. Irregularly shaped polygons and large differences in the size of areas being mapped can introduce misrepresentation. The message researchers want to get across might be lost, or even worse, misdirect the viewers to erroneous conclusions. <a href="https://www.tandfonline.com/eprint/q9w7iUhFJwzvBR84GkT9/full">This article</a> provides a helpful discussion of the problem illustrating the case with UK election maps. It is worth reading.</p>
<p>Fortunately, there are many methods in R to enhance the legibility of geographic information and the interpretability of what it is trying to be communicated.</p>
<p>Broadly, the options are:</p>
<ul>
<li>cartogram</li>
<li>hexmap</li>
<li>grid</li>
</ul>
<p>Selecting the appropriate method might depend on the research question being posed (e.g. clustering) and the data itself. Even once a method has been selected, there are different ways of operationalising them.</p>
<p>Let’s explore this using the example of the results of the 2016 EU referendum at Local Authority level, where remain areas clustered in London. A simple thematic map does not necessarily communicate this well because Local Authorities are both small and densely populated in London.</p>
<p>You can download the full set of EU referendum result data as a csv from <a href="https://www.electoralcommission.org.uk/find-information-by-subject/elections-and-referendums/past-elections-and-referendums/eu-referendum/eu-referendum-result-visualisations">the Electoral Commission webside</a>. Let’s read it straight into R:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="more-on-thematic-maps.html#cb51-1" tabindex="-1"></a>eu_ref <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://www.electoralcommission.org.uk/sites/default/files/2019-07/EU-referendum-result-data.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 382 Columns: 21
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (4): Region_Code, Region, Area_Code, Area
## dbl (17): id, Electorate, ExpectedBallots, VerifiedBallotPapers, Pct_Turnout...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>OKAY, now we need a shapefile to join it to. Remember when we got the Manchester lsoa shapefile with the <a href="https://borders.ukdataservice.ac.uk/bds.html">boundary selector</a>? Let’s go back, and this time get <em>Local Authority Districts</em> for <em>England</em>.</p>
<p>In this case that means select “English Districts, UAs and London Boroughs, 2011”:</p>
<p><img src="img/la_shp_dl.png" /></p>
<p>Once you have the file, download, extract (unzip) and put the folder in your working directory. Mine is in a subfolder in my working directory called data, so I point R inside that folder to find my shape file.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="more-on-thematic-maps.html#cb53-1" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/England_lad_2011_gen/england_lad_2011_gen.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `england_lad_2011_gen&#39; from data source 
##   `/Users/user/Desktop/resquant/crime_mapping_textbook/data/England_lad_2011_gen/england_lad_2011_gen.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 326 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 82644.8 ymin: 5349.399 xmax: 655976.9 ymax: 657599.5
## Projected CRS: OSGB36 / British National Grid</code></pre>
<p>We can now join the EU referendum data, as we have learned in the past weeks:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="more-on-thematic-maps.html#cb55-1" tabindex="-1"></a>eu_sf <span class="ot">&lt;-</span> <span class="fu">left_join</span>(las, eu_ref, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span> <span class="st">&quot;Area&quot;</span>))</span></code></pre></div>
<p>Now we can have a look at these data:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="more-on-thematic-maps.html#cb56-1" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb56-2"><a href="more-on-thematic-maps.html#cb56-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> eu_sf, <span class="fu">aes</span>(<span class="at">fill =</span> Pct_Leave)) </span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>We can see that in smaller LAs we don’t even really see the result, as the boundary lines pretty much cover everything. Hmm. Now what we can do is transform the shapes.</p>
<div id="activity-9-cartograms" class="section level3 hasAnchor" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Activity 9: Cartograms<a href="more-on-thematic-maps.html#activity-9-cartograms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The last thing we will do today is make some cartograms! Cartogram types of maps distort reality to convey information. They resize and exaggerate any variable on an attribute value.</p>
<p>There are different types of cartograms.</p>
<p>Density-equalizing (contiguous) cartograms are your traditional cartograms. In density-equalizing cartograms, map features bulge out a specific variable. Even though it distorts each feature, it remains connected during its creation. On the other hand, you can have Non-Contiguous Cartograms, where features in non-contiguous cartograms don’t have to stay connected. Finally, Dorling Cartogram (named after professor <a href="https://www.geog.ox.ac.uk/staff/ddorling.html">Danny Dorling</a>) uses shapes like circles and rectangles to depict area. These types of cartograms make it easy to recognize patterns!</p>
<p><img src="img/notNaAll3CartogramNewFrame.png" /></p>
<p>Now we can make our own as well, using the cartogram package.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="more-on-thematic-maps.html#cb57-1" tabindex="-1"></a><span class="fu">library</span>(cartogram)</span></code></pre></div>
<p>Within that there is the <code>cartogram()</code> function, which takes 2 arguments, 1 - the shape file (it can be a SpatialPolygonDataFrame or an sf object), and 2 - the variable which it should use to distort the polygon by.</p>
<p>In our data set we have a variable “electorate” which refers to the total number of registered electors, which we will use to distort the polygons:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="more-on-thematic-maps.html#cb58-1" tabindex="-1"></a><span class="co"># construct a cartogram using the size of the electorate in each LA</span></span>
<span id="cb58-2"><a href="more-on-thematic-maps.html#cb58-2" tabindex="-1"></a>eu_cartogram <span class="ot">&lt;-</span> <span class="fu">cartogram</span>(eu_sf, <span class="st">&quot;Electorate&quot;</span>)</span></code></pre></div>
<p>Again this is some labour intensive work, much like the grid making, you have some time to chill now. Maybe read up on the maths behind this tranformation as well, in the paper <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/j.0033-0124.1985.00075.x">Dougenik, J. A., Chrisman, N. R., &amp; Niemeyer, D. R. (1985). An Algorithm To Construct Continuous Area Cartograms. In The Professional Geographer, 37(1), 75-81.</a>.</p>
<p>I do have a tip for you if you want to make sure the process does not take too long. You can set a parameter in the cartogram function which is the “itermax” parameter. This specifies the maximum number of iterations we are happy with. If you don’t specify it’s set to 15. Let’s set to 5 for the sake of speed:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="more-on-thematic-maps.html#cb59-1" tabindex="-1"></a><span class="co"># construct a cartogram using the size of the electorate in each LA</span></span>
<span id="cb59-2"><a href="more-on-thematic-maps.html#cb59-2" tabindex="-1"></a>eu_cartogram <span class="ot">&lt;-</span> <span class="fu">cartogram_cont</span>(eu_sf, <span class="st">&quot;Electorate&quot;</span>, <span class="at">itermax =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>And if your cartogram has been created, you can now plot again the referendum results, but using the electorate to change the size of the local authority:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="more-on-thematic-maps.html#cb60-1" tabindex="-1"></a><span class="co"># plot the percentage voting leave onto our cartogram</span></span>
<span id="cb60-2"><a href="more-on-thematic-maps.html#cb60-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb60-3"><a href="more-on-thematic-maps.html#cb60-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> eu_cartogram, <span class="fu">aes</span>(<span class="at">fill =</span> Pct_Leave)) </span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>We can now see London much better, and see that darker coloured cluster where much smaller percentage of people voted leave.</p>
<p>Okay that’s probably enough for the day. Nice work crime mappers!</p>
</div>
</div>
<div id="references-and-further-reading" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> References and further reading<a href="more-on-thematic-maps.html#references-and-further-reading" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="binning" class="section level3 hasAnchor" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> Binning<a href="more-on-thematic-maps.html#binning" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><a href="http://indiemaps.com/blog/2011/10/hexbins/">Johnson, Zachary Forest. (18 October 2011). “Hexbins!” Retrieved from: http://indiemaps.com/blog/2011/10/hexbins/ (8 August 2014).</a></li>
<li><a href="https://www.mapbox.com/blog/binning-alternative-point-maps/">Smith, Nate. (25 May 2012). “Binning: An Alternative to Point Maps.” Mapbox. Retrieved from: https://www.mapbox.com/blog/binning-alternative-point-maps/ (8 August 2014).</a></li>
<li><a href="http://www.rpubs.com/cengel248/97543">Claudia A Engel’s fantastic R-pub on <em>Making Maps in R</em></a>.</li>
<li><a href="https://www.r-graph-gallery.com/329-hexbin-map-for-distribution/">Hexbin Graph Gallery</a></li>
<li><a href="https://www.r-bloggers.com/u-s-drought-monitoring-with-hexbin-state-maps-in-r/">US Drought Hexmap</a></li>
<li><a href="http://santiago.begueria.es/2016/04/mapping-with-ggplot2-hexbin-maps/">Hexbin with ggplot2</a></li>
</ul>
</div>
<div id="maup" class="section level3 hasAnchor" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> MAUP<a href="more-on-thematic-maps.html#maup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><a href="https://link.springer.com/article/10.1007/s10940-016-9297-6">Gerell, Manne. “Smallest is better? The spatial distribution of arson and the modifiable areal unit problem.” Journal of quantitative criminology 33.2 (2017): 293-318.</a></li>
<li><a href="https://www.uio.no/studier/emner/sv/iss/SGO9010/openshaw1983.pdf">Openshaw, Stan. “The modifiable areal unit problem. CATMOG (Concepts and techniques in modern geography) 38.” Geo Abstracts, Norwich. 1984.</a>.</li>
<li><a href="https://link.springer.com/chapter/10.1007/978-0-387-09688-9_5">Rengert, George F., and Brian Lockwood. “Geographical units of analysis and the analysis of crime.” Putting crime in its place. Springer, New York, NY, 2009. 109-122.</a></li>
</ul>
</div>
<div id="transforming-polygons-1" class="section level3 hasAnchor" number="5.6.3">
<h3><span class="header-section-number">5.6.3</span> Transforming polygons<a href="more-on-thematic-maps.html#transforming-polygons-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><a href="https://www.tandfonline.com/doi/full/10.1111/j.1467-8306.2004.09401004.x">Waldo Tobler (2004) Thirty Five Years of Computer Cartograms, Annals of the Association of American Geographers, 94:1, 58-73, DOI: 10.1111/j.1467-8306.2004.09401004.x</a></li>
<li><a href="https://rpubs.com/langton_/visual_geography_study">Langton, S.H. &amp; Solymosi, R. (2018) ‘Visualising geographic information: examining methods of improving the thematic map.’ RPubs. Available: https://rpubs.com/langton_/visual_geography_study</a></li>
</ul>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="performing-spatial-operations-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="studying-spatial-point-patterns.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-week5.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["crime_mapping_textbook.pdf", "crime_mapping_textbook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
